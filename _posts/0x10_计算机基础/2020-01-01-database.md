---
layout: post
title: æ•°æ®åº“åŸç†
categories: å­¦ä¹ ä¸­
tags: 
keywords:
description:
permalink: /:title:output_ext
order: 105
---


## åˆæ­¥

æ•°æ®åº“ï¼šå°†ä¿¡æ¯è§„èŒƒåŒ–ã€ç”µå­åŒ–ï¼Œè€Œå½¢æˆçš„åº“ï¼Œä»¥ä¾¿å¿«é€Ÿæœ‰æ•ˆçš„å­˜å‚¨ã€æ£€ç´¢ã€ç»Ÿè®¡ã€ç®¡ç†


æ•°æ®åº“ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
- æ•°æ®åº“ï¼ˆDBï¼ŒDatabaseï¼‰
- æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼ŒDatabase Management Systemï¼‰
- æ•°æ®åº“åº”ç”¨ï¼ˆDBAPï¼ŒDatabase Applicationï¼‰
- æ•°æ®åº“ç®¡ç†å‘˜ï¼ˆDBAï¼ŒDatabase Administratorï¼‰
- è®¡ç®—æœºåŸºæœ¬ç³»ç»Ÿ 


![caption: æ•°æ®åº“ç³»ç»Ÿ](/a/computer/database/overview.gif)



æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåº”è¯¥æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Ÿï¼ˆç”¨æˆ·è§’åº¦ï¼‰
- æ•°æ®åº“å®šä¹‰
    - DBMS æä¾› **æ•°æ®å®šä¹‰è¯­è¨€**ï¼ˆDDLï¼ŒData Definition Languageï¼‰ç»™ç”¨æˆ·
    - ç”¨æˆ·ä½¿ç”¨ DDL æè¿°è¡¨æ ¼å¼
    - DBMS æŒ‰ç…§ç”¨æˆ·æè¿°ï¼Œåˆ›å»ºæ•°æ®åº“å’Œå…¶ä¸­çš„ Table
- æ•°æ®åº“æ“çºµ
    - DBMS æä¾› **æ•°æ®æ“çºµè¯­è¨€**ï¼ˆDMLï¼ŒData Manipulation Languageï¼‰
    - ç”¨æˆ·ä½¿ç”¨ DML æè¿°æ‰€è¦è¿›è¡Œçš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰æ“ä½œ
    - DBMS æŒ‰ç…§ç”¨æˆ·æè¿°ï¼Œæ‰§è¡Œè¿™äº›æ“ä½œ
- æ•°æ®åº“ä½¿ç”¨
    - DBMS æä¾› **æ•°æ®æ§åˆ¶è¯­è¨€**ï¼ˆDCLï¼ŒData Control Languageï¼‰
    - ç”¨æˆ·ä½¿ç”¨ DCL æè¿°å…¶å¯¹æ•°æ®åº“è¦å®æ–½çš„æ§åˆ¶ï¼ˆç”¨æˆ·è®¿é—®æƒé™ï¼‰
    - DBMS æŒ‰ç…§ç”¨æˆ·çš„æè¿°ï¼Œå®é™…è¿›è¡Œæ§åˆ¶
- æ•°æ®åº“ç»´æŠ¤
    - DBMS æä¾›ä¸€ç³»åˆ—ç¨‹åºç»™ç”¨æˆ·ï¼Œè¿™äº›ç¨‹åºæä¾›äº†å¯¹æ•°æ®åº“ç»´æŠ¤çš„å„ç§åŠŸèƒ½
    - ç”¨æˆ·ä½¿ç”¨è¿™äº›ç¨‹åºå¯¹æ•°æ®åº“ç»´æŠ¤
    - æ•°æ®åº“ç»´æŠ¤ç¨‹åºï¼Œä¸€èˆ¬ç”± DBA ä½¿ç”¨å’ŒæŒæ¡



æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåº”è¯¥æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Ÿï¼ˆç³»ç»Ÿè§’åº¦ï¼‰
- è¯­è¨€ç¼–è¯‘å™¨ã€‚æŠŠæ•°æ®åº“è¯­è¨€ï¼Œç¿»è¯‘æˆ DBMS å¯æ‰§è¡Œçš„å‘½ä»¤ã€‚å¦‚ DDL ç¼–è¯‘å™¨ï¼ŒDML ç¼–è¯‘å™¨ï¼ŒDCL ç¼–è¯‘å™¨
- æŸ¥è¯¢ä¼˜åŒ–ã€æŸ¥è¯¢å®ç°ã€‚æé«˜æ£€ç´¢é€Ÿåº¦
- æ•°æ®åº“çš„å­˜å–ã€ç´¢å¼•ã€‚æä¾›åœ¨ç£ç›˜ã€ç£å¸¦ä¸Šçš„é«˜æ•ˆå­˜å–æ‰‹æ®µ
- é€šä¿¡æ§åˆ¶ã€‚ç½‘ç»œç¯å¢ƒä¸‹çš„æ•°æ®åº“æ“ä½œä¸æ•°æ®ä¼ è¾“æ‰‹æ®µ
- äº‹åŠ¡ç®¡ç†ã€‚é«˜å¯é æ€§ï¼Œé¿å…å¹¶å‘æ“ä½œé”™è¯¯
- æ•…éšœæ¢å¤ã€‚æ•°æ®åº“è‡ªåŠ¨å›å¤åˆ°æ•…éšœå‘ç”Ÿå‰æ­£ç¡®çŠ¶æ€çš„æ‰‹æ®µã€‚å¦‚å¤‡ä»½ã€è¿è¡Œæ—¥å¿—
- å®‰å…¨æ€§æ§åˆ¶ã€‚é¿å…éæˆæƒç”¨æˆ·è®¿é—®æ•°æ®åº“
- å®Œæ•´æ€§æ§åˆ¶ã€‚æä¾›æ•°æ®ã€æ•°æ®æ“ä½œæ­£ç¡®æ€§æ£€æŸ¥æ‰‹æ®µ
- æ•°æ®å­—å…¸ç®¡ç†ã€‚ç®¡ç†ç”¨æˆ·å®šä¹‰çš„ä¿¡æ¯
- åº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰ï¼šæä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ DBMS ç‰¹å®šåŠŸèƒ½çš„æ‰‹æ®µ
- æ•°æ®åº“æ•°æ®è£…è½½ã€é‡ç»„
- æ•°æ®åº“æ€§èƒ½åˆ†æã€‚ç»Ÿè®¡è¿è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ€§èƒ½æ•°æ®ï¼Œä»¥ä¾¿ä¼˜åŒ–ã€‚


å…¸å‹çš„ DBMSï¼š
- Oracle
- MS SQL
- ...


## æ•°æ®åº“ç³»ç»Ÿçš„ç»“æ„æŠ½è±¡


DBMS ç®¡ç†æ•°æ®çš„ä¸‰ä¸ªå±‚æ¬¡
- External levelï¼ˆUser levelï¼‰ã€‚æŸä¸€ç”¨æˆ·èƒ½å¤Ÿçœ‹åˆ°çš„æ•°æ®ï¼Œæ˜¯å…¨å±€æ•°æ®çš„æŸä¸€éƒ¨åˆ†
- Conceptual levelï¼ˆLogic levelï¼‰ã€‚å…¨å±€è§’åº¦ç†è§£çš„æ•°æ®
- Internal levelï¼ˆPhysical levelï¼‰ã€‚å­˜å‚¨åœ¨ä»‹è´¨ä¸Šçš„æ•°æ®ï¼Œå«è·¯å¾„ã€å­˜å‚¨æ–¹å¼ã€ç´¢å¼•æ–¹å¼ç­‰

æ•°æ®å’Œæ¨¡å¼çš„åŒºåˆ«
- æ•°æ®ï¼ˆView/Dataï¼‰ã€‚æ˜¯æ•°æ®æœ¬èº«ã€‚
- æ¨¡å¼ï¼ˆSchemaï¼‰ã€‚æ•°æ®çš„ç»“æ„æ€§ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š `table_student(id char(8), name char(10))`


**ä¸‰çº§æ¨¡å¼**ï¼ˆå¯¹åº”ä¸Šé¢çš„3ä¸ªå±‚æ¬¡ï¼‰
- External Schemaã€‚åŒä¹‰è¯ï¼šç”¨æˆ·æ¨¡å¼ã€å¤–æ¨¡å¼ã€å±€éƒ¨æ¨¡å¼
- Conceptual Schemaã€‚æ¨¡å¼é»˜è®¤æŒ‡çš„æ˜¯ Conceptual Schemaã€‚åŒä¹‰è¯ï¼šå…¨å±€æ¨¡å¼ã€æ¦‚å¿µæ¨¡å¼ã€é€»è¾‘æ¨¡å¼
- Internal Schemaã€‚åŒä¹‰è¯ï¼šå†…æ¨¡å¼ã€å­˜å‚¨æ¨¡å¼


**ä¸¤å±‚æ˜ åƒ**
- E-C Mappingã€‚External Schema åˆ° Conceptual Schema çš„æ˜ å°„
- C-I Mappingã€‚Conceptual Schema åˆ° Internal Schema çš„æ˜ å°„

ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ
- é€»è¾‘æ•°æ®ç‹¬ç«‹æ€§ã€‚Conceptual Schema å˜åŒ–æ—¶ï¼Œå¯ä»¥ä¸æ”¹å˜ External Schemaï¼Œåªéœ€è¦æ”¹åŠ¨ E-C Mapping
- ç‰©ç†æ•°æ®ç‹¬ç«‹æ€§ã€‚Internal Schema å˜åŒ–æ—¶ï¼Œå¯ä»¥ä¸æ”¹å˜ Conceptual Schemaï¼Œåªéœ€è¦æ”¹åŠ¨ C-I Mapping



**æ•°æ®æ¨¡å‹**ï¼š
- è§„å®šç»Ÿä¸€æè¿°æ–¹å¼ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ã€æ“ä½œã€çº¦æŸã€‚
- â€œæ•°æ®æ¨¡å‹â€æ˜¯â€œæ•°æ®æ¨¡å¼â€çš„æŠ½è±¡ï¼Œâ€œæ•°æ®æ¨¡å¼â€æ˜¯æ•°æ®æœ¬èº«çš„æŠ½è±¡
- 3ç§ç»å…¸æ•°æ®æ¨¡å‹ï¼š
    - **å…³ç³»æ¨¡å‹**ï¼šè¡¨çš„å½¢å¼ç»„ç»‡æ•°æ®
    - **å±‚æ¬¡æ¨¡å‹**ï¼šæ ‘çš„å½¢å¼ç»„ç»‡æ•°æ® 
    - **ç½‘çŠ¶æ¨¡å‹**ï¼šå›¾çš„å½¢å¼ç»„ç»‡æ•°æ®


æ•°æ®åº“çš„æ¼”å˜
- ä»æ–‡ä»¶ç³»ç»Ÿåˆ°æ•°æ®åº“
    - æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜ç‚¹ï¼šç”¨æˆ·ï¼ˆç¨‹åºï¼‰ä¸å¿…è€ƒè™‘ç‰©ç†ç»†èŠ‚
    - ç¼ºç‚¹ï¼šæ•°æ®ä¸ç¨‹åºè€¦åˆï¼Œéœ€è¦åœ¨ç¨‹åºä¸­å®šä¹‰æ•°æ®çš„ç»„ç»‡ã€‚
    - å› æ­¤éœ€è¦ä¸€ä¸ªä¸“é—¨çš„ DBMS ä¸“é—¨å¤„ç†æ•°æ®
- ä»å±‚æ¬¡æ¨¡å‹ã€ç½‘çŠ¶æ¨¡å‹ï¼Œåˆ°å…³ç³»æ•°æ®åº“
    - å±‚æ¬¡æ¨¡å‹ã€ç½‘çŠ¶æ¨¡å‹ï¼Œæ•°æ®æ˜¯ç”¨æŒ‡é’ˆè”ç³»èµ·æ¥çš„ï¼Œåªèƒ½é€ä¸€æ“ä½œã€‚
    - å…³ç³»æ•°æ®åº“ä¸ä¾èµ–æŒ‡é’ˆã€è·¯å¾„ï¼Œç†è®ºåŸºç¡€å®Œå–„
- å…³ç³»æ•°æ®åº“åˆ°å¯¹è±¡æ•°æ®åº“
    - å…³ç³»ç¬¬ä¸€èŒƒå¼ï¼šæ¯ä¸ªå•å…ƒæ ¼åªèƒ½æœ‰1ä¸ªå€¼
    - **å¯¹è±¡å…³ç³»æ•°æ®åº“**ï¼šä½¿ç”¨æ•°æ®ç»“æ„/é¢å‘å¯¹è±¡ç‰¹ç‚¹ï¼Œæ¥å°è£…é‚£äº›ä¸æ»¡è¶³å…³ç³»ç¬¬ä¸€èŒƒå¼çš„æ•°æ®ï¼ˆä¸€ä¸ªå•å…ƒæ ¼æœ‰å¤šè¡Œ/å¤šåˆ—çš„æƒ…å†µï¼‰ã€‚
    - **XMLæ•°æ®åº“**ï¼šåŠç»“æ„åŒ–æ•°æ®åº“ï¼ŒæŠŠæ•°æ®å’Œæ•°æ®çš„è¯­ä¹‰åˆå¹¶å­˜å‚¨ã€‚æ˜¯ä¸€ç§æ ‘å‹çš„æ•°æ®ç»„ç»‡å½¢å¼ã€‚
- **ODBC**ï¼ˆOpen Database Connectionï¼‰/ï¼ˆJava å¯¹åº”çš„æ˜¯ JDBCï¼‰ï¼šä¸€ç§æ•°æ®åº“æ ‡å‡†ï¼Œå¯ä»¥è®©åº”ç”¨ç¨‹åºç”¨ç»Ÿä¸€çš„æ–¹å¼è®¿é—®ä¸åŒçš„æ•°æ®åº“
- æ–°å‹æ•°æ®åº“ã€‚åœ¨ä¸åŒçš„é¢†åŸŸï¼Œæœ‰ä¸åŒçš„æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼šä¸å®æ—¶æŠ€æœ¯ç»“åˆçš„å®æ—¶æ•°æ®åº“ï¼Œä¸å·¥ç¨‹æ–‡ä»¶ç»“åˆçš„å·¥ç¨‹æ•°æ®åº“ï¼Œä¸å›¾åƒç»“åˆçš„å›¾åƒæ•°æ®åº“



## å…³ç³»æ•°æ®åº“


å…³ç³»æ¨¡å‹ä¸‰è¦ç´ 
- åŸºæœ¬ç»“æ„ï¼šRelation/Table
- æ“ä½œï¼ˆRelation Operatorï¼‰
    - åŸºæœ¬æ“ä½œï¼šå¹¶ï¼ˆUnionï¼‰ã€å·®ï¼ˆDifferenceï¼‰ã€å¹¿ä¹‰ç§¯ï¼ˆProductï¼‰ã€é€‰æ‹©ï¼ˆSelectionï¼‰ã€æŠ•å½±ï¼ˆProjectionï¼‰
    - æ‰©å±•æ“ä½œï¼šäº¤ï¼ˆintersectionï¼‰ã€è¿æ¥ï¼ˆjoinï¼‰ã€é™¤ï¼ˆDivisionï¼‰
- å®Œæ•´æ€§çº¦æŸï¼šå®ä½“å®Œæ•´æ€§ã€å‚ç…§å®Œæ•´æ€§ã€ç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´æ€§


å…³ç³»æ•°æ®åº“ï¼šæ“ä½œçš„å¯¹è±¡æ˜¯é›†åˆï¼Œä¸€æ¬¡ä¸€é›†åˆï¼ˆSet-at-a-timeï¼‰ã€‚å±‚æ¬¡æ¨¡å¼ã€ç½‘çŠ¶æ¨¡å‹ï¼šæ“ä½œå¯¹è±¡æ˜¯ä¸€æ¬¡ä¸€è®°å½•ï¼ˆRecord-at-a-timeï¼‰


-----------------

ä¸€äº›å®šä¹‰

**Domainï¼ˆåŸŸï¼‰**ï¼šåˆ—çš„å–å€¼èŒƒå›´é›†åˆï¼Œä¾‹å¦‚ï¼Œæ€§åˆ«è¿™ä¸ªå­—æ®µçš„åŸŸå°±æ˜¯ `{ç”·, å¥³}`
- **Cardinalityï¼ˆåŸºæ•°ï¼‰**ï¼šé›†åˆçš„å…ƒç´ ä¸ªæ•°


**Cartesian Productï¼ˆç¬›å¡å°”ç§¯ï¼‰**ï¼Œæ‰€æœ‰å¯èƒ½æ€§çš„é›†åˆï¼š
- ä¸€ç»„åŸŸ $D_1,D_2,...,D_n$ çš„ ç¬›å¡å°”ç§¯æ˜¯ï¼š$$D_1 \times D_2 \times ... \times D_n =\{ (d_1,d_2,...,d_n) \mid d_i \in D_i, i=1,...,n \}$$
- æ¯ä¸ªå…ƒç´  $(d_1,d_2,...,d_n)$ å«åš **n-å…ƒç»„ï¼ˆn-tupleï¼‰**
- å…ƒç»„çš„æ¯ä¸ªå€¼ $d_i$ å«åš **åˆ†é‡ï¼ˆcomponentï¼‰**

**å…³ç³»ï¼ˆRelationï¼‰**ï¼š$D_1 \times D_2 \times ... \times D_n$ çš„ä¸€ä¸ªå­é›†

**Schema** ç”¨ $R(A_1:D_1, A_2:D_2,...,A_n:D_n)$ è¡¨ç¤º
- å…¶ä¸­ R æ˜¯å…³ç³»çš„åå­—
- $A_i$ æ˜¯å±æ€§åå­—
- $D_i$ æ˜¯åŸŸ
- n æ˜¯å…³ç³»çš„ **degreeï¼ˆåº¦ã€ç›®ï¼‰**
- ä¾‹å¦‚ `Student(S# char(8), Sname char(10), Ssex char(2), Sage integer)`


å…³ç³»çš„ç‰¹æ€§
- åˆ—æ˜¯åŒè´¨çš„ï¼šæ•°æ®ç±»å‹ç›¸åŒï¼ˆæ¥è‡ªåŒä¸€ä¸ªåŸŸï¼‰
- åˆ—åå¿…é¡»ä¸åŒï¼ˆ$A_i$ ä¸åŒï¼‰
- åˆ—ä½ç½®å¯äº’æ¢ï¼Œè¡Œä½ç½®å¯äº’æ¢ã€‚ä¸é ä½ç½®ç´¢å¼•å·ç¡®å®šè¡Œ/åˆ—ã€‚è¡Œ/åˆ—äº’æ¢åï¼Œä»ç„¶æ˜¯åŒä¸€ä¸ªå…³ç³»ã€‚
- ç†è®ºä¸Šï¼Œå…³ç³»ä»»æ„ä¸¤ä¸ªå…ƒç»„ä¸èƒ½å®Œå…¨ç›¸åŒï¼ˆå› ä¸ºå®ƒæ˜¯é›†åˆï¼‰ã€‚å®è·µä¸Šä¸ä¸€å®šå®Œå…¨éµå®ˆã€‚
- å±æ€§ä¸å¯å†åˆ†ï¼š**å…³ç³»ç¬¬ä¸€èŒƒå¼**
- **Candidate Keyï¼ˆå€™é€‰ç ã€å€™é€‰é”®ï¼‰**ï¼šå…³ç³»ä¸­çš„ä¸€ç»„å±æ€§ï¼Œå…¶å€¼å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå…ƒç»„ã€‚ä¾‹å¦‚ `å­¦ç”Ÿ(S#,Sname,Sage,Sclass)` ä¸­çš„ `S#` æ˜¯å€™é€‰ç ï¼›`é€‰è¯¾è®°å½•(S#,C#,Sname,Cname,Grade)` ä¸­çš„ `(S#,C#)` æ˜¯å€™é€‰ç ã€‚
    - å½“ç„¶ï¼Œå€™é€‰ç å¯ä»¥æœ‰å¤šç§ï¼Œå¯ä»¥é€‰å®šå…¶ä¸­çš„ä¸€ä¸ªä½œä¸º **ä¸»ç **ï¼Œä¾‹å¦‚ä¸Šé¢é€‰è¯¾è®°å½•ä¸­çš„ `(S#,C#)`
    - ä»»ä½•å€™é€‰ç ä¸­éƒ½æœ‰çš„å±æ€§å«åš **ä¸»å±æ€§**ï¼Œä¾‹å¦‚ä¸Šé¢çš„ `C#` å’Œ `S#`ï¼Œå…¶å®ƒéƒ½æ˜¯ **éä¸»å±æ€§**
    - æœ€ç®€å•çš„ï¼šå€™é€‰ç åªæœ‰ä¸€ä¸ªå±æ€§ã€‚æœ€æç«¯çš„ï¼šå…¨éƒ¨å±æ€§éƒ½æ˜¯ä¸»å±æ€§ï¼ˆæˆä¸ºå…¨ç  All-Keyï¼‰
- **Foreign Key**ï¼ˆå¤–ç /å¤–é”®ï¼‰ï¼šå…³ç³»Rçš„ä¸€ä¸ªå±æ€§ç»„ï¼Œå®ƒä¸æ˜¯Rçš„å€™é€‰ç ï¼Œä½†å®ƒæ˜¯å¦ä¸€å…³ç³» S çš„å€™é€‰ç ã€‚
    - ä¾‹å¦‚ï¼šâ€œåˆåŒâ€å…³ç³»ä¸­çš„â€œå®¢æˆ·å·â€ä¸æ˜¯å€™é€‰ç ï¼Œä½†å®ƒæ˜¯â€œå®¢æˆ·â€å…³ç³»ä¸­çš„å€™é€‰ç 
    - ä¸¤ä¸ªå…³ç³»é  å¤–ç  è¿æ¥èµ·æ¥


![caption: ç¬¦åˆç¬¬ä¸€èŒƒå¼](/a/computer/database/1nf.svg)

![caption: ä¸ç¬¦åˆç¬¬ä¸€èŒƒå¼](/a/computer/database/1nf2.svg)


**å®Œæ•´æ€§**
- **å®ä½“å®Œæ•´æ€§**ï¼šä¸»ç çš„å€¼ä¸èƒ½ä¸ºç©ºå€¼
- **å‚ç…§å®Œæ•´æ€§**ï¼šå¦‚æœ R1çš„å¤–ç  Fk ä¸ R2 çš„ä¸»ç  Fk å¯¹åº”ï¼Œé‚£ä¹ˆ R1 çš„æ¯ä¸ªå…ƒç»„çš„ Fk å€¼ï¼Œè¦ä¹ˆç­‰äº R2 æŸå…ƒç»„çš„ Pk å€¼ï¼Œè¦ä¹ˆä¸ºç©ºã€‚
    - ä¸¾ä¾‹æ¥è¯´ï¼Œâ€œå­¦ç”Ÿâ€è¡¨çš„å¤–ç â€œç­çº§å·â€ï¼Œä¸â€œç­çº§â€è¡¨çš„ä¸»ç â€œç­çº§å·â€å¯¹åº”ï¼Œé‚£ä¹ˆæ¯ä¸ªå­¦ç”Ÿçš„â€œç­çº§å·â€ï¼Œè¦ä¹ˆåœ¨â€œç­çº§â€è¡¨ä¸­æœ‰ï¼Œè¦ä¹ˆä¸ºç©ºï¼ˆä¸ºç©ºå¯èƒ½æ˜¯è¿˜æ²¡ç»™ä»–åˆ†ç­ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªå­¦ç”Ÿä¸å¯èƒ½è¢«åˆ†åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„ç­é‡Œã€‚
- **ç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´æ€§**ï¼šç”¨æˆ·è¦æ±‚æŸä¸ªå­—æ®µåœ¨çº¦æŸèŒƒå›´å†…ã€‚ä¾‹å¦‚å¹´é¾„è¦å¤§äº0å°äº200ï¼›ä¾‹å¦‚æ€§åˆ«åªæœ‰ç”·/å¥³



## å…³ç³»è¿ç®—

### å…³ç³»ä»£æ•°

å…³ç³»ä»£æ•°ï¼šä»¥é›†åˆä¸ºä¸­å¿ƒçš„è¿ç®—ï¼Œæ“ä½œçš„å¯¹è±¡æ˜¯é›†åˆï¼Œæ“ä½œçš„ç»“æœä¹Ÿæ˜¯é›†åˆ
- å…³ç³»ä»£æ•°åŸºæœ¬æ“ä½œï¼šå¹¶ã€å·®ã€ç§¯ã€é€‰æ‹©ã€æŠ•å½±
- å…³ç³»ä»£æ•°æ‰©å±•æ“ä½œï¼šäº¤ã€theta-è¿æ¥ã€è‡ªç„¶è¿æ¥
- å…³ç³»ä»£æ•°å¤æ‚æ‰©å±•æ“ä½œï¼šé™¤ã€å¤–è¿æ¥


------------------

**å¹¶ï¼ˆunionï¼‰**

å‰æï¼šå…³ç³» R å’Œå…³ç³» S æœ‰ç›¸å®¹æ€§ã€‚

å…³ç³» R å’Œå…³ç³» S æœ‰ **ç›¸å®¹æ€§**ï¼Œå‡è®¾ `R(A1, A2,... An)`ï¼Œ`S(B1, B2,..., Bm)`
:    1. R å’Œ S çš„å±æ€§æ•°ç›®ç›¸åŒï¼Œå³ n = m
     2. å¯¹äºä»»æ„çš„ iï¼ŒAi å’Œ Bi çš„åŸŸç›¸åŒ

ä¸¾ä¾‹ï¼Œè¿™ä¸¤ä¸ªå…³ç³»æ˜¯ç›¸å®¹çš„ï¼š`STUDENT(SID char(10), Sname char(8), Age char(3))` å’Œ `PROFESSOR(PID char(10), Pname char(8), Age char(3))`


å¹¶æ“ä½œçš„å®šä¹‰ï¼šRå’ŒSæ˜¯ç›¸å®¹çš„ï¼Œé‚£ä¹ˆ $$R \cup S = \{ t \mid t\in R \lor t \in S\}$$


è§£é‡Šï¼šå®é™…ä¸Šå°±æ˜¯ SQL ä¸­çš„ **UNION**

-------------------

**å·®**ï¼ˆDifferenceï¼‰

å®šä¹‰ï¼šå‰ææ˜¯ R å’Œ S æ˜¯ç›¸å®¹çš„ï¼Œé‚£ä¹ˆ $$R - S = \{ t \mid t\in R \lor t \not\in S\}$$


-------------------

**ç¬›å¡å°”ç§¯**ï¼ˆCartesian Productï¼‰

å®šä¹‰ï¼šR å’Œ S ä¸­å…ƒç»„çš„æ‰€æœ‰å¯èƒ½çš„ç»„åˆ

ç”¨æ•°å­¦è¯­è¨€å®šä¹‰ï¼š$$R \times S = \{ (a_1, a_2,..., a_n, b_1, b_2,..., b_n) \mid (a_1, a_2,..., a_n) \in R \land (b_1, b_2,..., b_n) \in S\}$$


æ€§è´¨
- å¯äº¤æ¢ï¼Œ$R \times S = S \times R$
- å¦‚æœ R å’Œ S çš„å±æ€§ä¸ªæ•°ä¸º n å’Œ mï¼Œé‚£ä¹ˆ $R \times S$ çš„å±æ€§ä¸ªæ•°ä¸º n + m
- å¦‚æœ R å’Œ S çš„åŸºæ•°åˆ†åˆ«ä¸º x å’Œ yï¼Œé‚£ä¹ˆ $R \times S$ çš„åŸºæ•°ä¸º `n * m`


-----------------------

**é€‰æ‹©**ï¼ˆSelectï¼‰

$$\sigma_{con} (R) = \{ t \mid t \in R \land \mathrm{con}(t) = \mathrm{true} \}$$
- å…¶ä¸­ con æ˜¯ç”±ä¸€ç³»åˆ—é€»è¾‘è¿ç®—ç¬¦ã€æ¯”è¾ƒè¡¨è¾¾å¼ç»„æˆçš„è¡¨è¾¾å¼


è§£é‡Šï¼šå°±æ˜¯ SQL è¯­å¥ä¸­çš„ WHERE

------------------------

**æŠ•å½±**ï¼ˆProjectï¼‰

å®šä¹‰ï¼šé€‰å‡º R ä¸­çš„ä¸€äº›å±æ€§ï¼Œç„¶åå½¢æˆæ–°çš„å…³ç³»

æ•°å­¦æè¿°: å‡è®¾ $R(A_1, A_2, ..., A_n)$ï¼Œé‚£ä¹ˆ $$\pi_{A_{i_1},A_{i_2},...A_{i_k}} = \{(t[A_{i_1}], t[A_{i_2}],..., t[A_{i_k}]) \mid t \in R\}$$
- å…¶ä¸­ï¼Œ$$\{A_{i_1},A_{i_2},...A_{i_k}\} \subseteq \{ A_1, A_2, ... , A_n\}$$


è§£é‡Šï¼šå°±æ˜¯ SQL è¯­å¥ä¸­çš„ SELECT

---------------------

**äº¤**ï¼ˆIntersectionï¼‰

å®šä¹‰ï¼šå‰ææ˜¯ R å’Œ S æ˜¯ç›¸å®¹çš„ï¼Œé‚£ä¹ˆ $$R \cap S = \{ t \mid t\in R \land t \in S\}$$


æ€§è´¨ï¼š$R \cap S = R - (R- S) = S - (S - R)$


-----------------------

**theta-è¿æ¥**ï¼ˆtheta-joinï¼Œ Î¸-joinï¼‰

$R \mathop{\bowtie}\limits_{A \theta B} S = \sigma_{t[A] \theta s[B]}(R \times S)$

- ç”¨è¯­è¨€æè¿°å°±æ˜¯ï¼šå…ˆåšç¬›å¡å°”ç§¯ï¼Œç„¶åæ‰¾å‡ºæ»¡è¶³ $\theta$ æ¡ä»¶çš„é‚£äº›å…ƒç»„ï¼ˆâ€œé€‰æ‹©â€ï¼‰ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„å…³ç³»
- A å’Œ B å¿…é¡»æœ‰å¯æ¯”æ€§
- $\theta$ å¯ä»¥æ˜¯ `>, >=, <, <=, =, !=`


![caption: Î¸-è¿æ¥](/a/computer/database/theta_join.svg)


è¯´æ˜ï¼š
1. ç¬›å¡å°”ç§¯æ˜¯æ•°å­¦ä¸Šçš„ï¼Œåœ¨ç¨‹åºå®ç°ä¸Šä¸ä¼šå…ˆåšç¬›å¡å°”ç§¯
2. æœ€å¸¸è§çš„æ˜¯ **ç­‰å€¼è¿æ¥** $R \mathop{\bowtie}\limits_{A = B} S = \sigma_{t[A] = s[B]}(R \times S)$

------------------------

**è‡ªç„¶è¿æ¥**ï¼ˆNatural-Joinï¼‰
- æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç­‰å€¼è¿æ¥
- å…¶è¿æ¥æ¡ä»¶æ˜¯ï¼ŒRå’ŒSç›¸åŒçš„å±æ€§ï¼Œå…¶å€¼ç›¸åŒ
- $R \bowtie S = \sigma_{t[B] = s[B]}(R \times S)$
- å…¶ä¸­ B æ˜¯ä¸€ç»„åå­—ç›¸åŒçš„å±æ€§
- æœ€ç»ˆçš„ç»“æœï¼Œéœ€è¦å»æ‰ä¸€ä¸ªç›¸åŒçš„å±æ€§ï¼ˆåªä¿ç•™ä¸€ä¸ªï¼‰


------------------------

**é™¤**ï¼ˆDivisionï¼‰ $R \div S$

å‰æï¼šå¯¹äº $R(A_1, A2_,... A_n)$ å’Œ $S(B_1, B_2,..., B_m)$ï¼Œ$$\{ B_1, B_2,..., B_m \} \subset \{A_1,A_2,...,A_n\}$$ï¼Œï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼ŒS çš„å±æ€§é›†æ˜¯ R å±æ€§é›†çš„çœŸå­é›†ï¼Œå¹¶ä¸” $m < n$ï¼‰



å®šä¹‰ï¼š
1. ç»“æœçš„å±æ€§ï¼Œä¸º $$\{C_1,C_2,...,C_k\} = \{A_1,A_2,...,A_n\} - \{ B_1, B_2,..., B_m \}$$ï¼Œå…¶ä¸­ $k = n - m$
2. ç»“æœçš„å…ƒç»„ï¼Œ$(c_1,...,c_k)$ åº”å½“æ»¡è¶³ï¼šå®ƒä¸ S ä¸­æ¯ä¸ªå…ƒç»„ $(b_1,...,b_m)$ ç»“åˆï¼Œå½¢æˆçš„æ–°å…ƒç»„ï¼Œéƒ½æ˜¯ R ä¸­çš„å…ƒç»„ $(a_1,...,a_n)$

æ•°å­¦æè¿°
- é›†åˆè¯­è¨€æè¿°ï¼š$$R \div S = \{ t \mid t \in \pi_{R-S} \land (\forall u\in S \to tu \in R)\}$$
- å…³ç³»ä»£æ•°æè¿°ï¼š$R \div S = \pi_{R-S}(R) - \pi_{R-S}((\pi_{R-S}(R) \times S) - R)$


ç°å®æè¿°ï¼šRæ˜¯å­¦ç”Ÿé€‰è¯¾è¡¨ï¼ŒSæ˜¯è¯¾ç¨‹è¡¨ï¼Œ $R \div S$ æŸ¥è¯¢å‡ºâ€œé€‰ä¿®äº†å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿâ€

--------------------

**å¤–è¿æ¥**ï¼ˆOuter-Joinï¼‰
- **left outer join**ï¼ˆå·¦å¤–è¿æ¥ï¼‰ï¼š$R âŸ• S$
- **right outer join**ï¼ˆå³å¤–è¿æ¥ï¼‰ï¼š$R âŸ– S$
- **full outer join** ï¼ˆå…¨å¤–è¿æ¥ï¼‰ï¼š$R âŸ— S$


æè¿°ï¼šåœ¨è‡ªç„¶è¿æ¥ä¸­ï¼Œæ²¡æœ‰åŒ¹é…ä¸Šçš„å…ƒç»„éƒ½ä¸¢æ‰äº†ï¼Œå¤–è¿æ¥ä½¿æ²¡æœ‰åŒ¹é…ä¸Šçš„å…ƒç»„ä¸ä¸¢æ‰ï¼Œè€Œæ˜¯æŠŠæ²¡åŒ¹é…ä¸Šçš„ä¹ŸåŠ å…¥è¿›å»ï¼Œé¢å¤–çš„å­—æ®µè®¾å®šä¸ºç©ºå€¼


### å…³ç³»å…ƒç»„æ¼”ç®—


å…³ç³»æ¼”ç®—åŒ…æ‹¬ï¼š
- **å…³ç³»å…ƒç»„æ¼”ç®—**ï¼Œä»¥å…ƒç»„ä½œä¸ºè°“è¯å˜é‡
- **å…³ç³»åŸŸæ¼”ç®—**ï¼Œä»¥åŸŸå˜é‡ä¸ºè°“è¯å˜é‡




å…³ç³»å…ƒç»„æ¼”ç®—å®šä¹‰ï¼š$$\{ t \mid P(t) \}$$
- æ„æ€ï¼šæ‰€æœ‰è°“è¯ P ä¸ºçœŸçš„å…ƒç»„ t çš„é›†åˆ
- tæ˜¯å…ƒç»„
- $t\in R$ è¡¨ç¤ºå…ƒç»„ t åœ¨å…³ç³» R ä¸­
- $t[A]$ è¡¨ç¤º t åœ¨å±æ€§ A ä¸Šçš„å€¼
- $P(t)$ æ˜¯å…¬å¼ï¼Œå¯ä»¥é€’å½’åœ°æ„é€ 


å…¬å¼çš„å®šä¹‰ï¼šå…¬å¼ $P(t)$ å¯ä»¥é€’å½’åœ°æ„é€ 
- ä¸‰ç§åŸå­å…¬å¼
    - $s\in R$
    - $s[A] \theta c$
    - $s[A] \theta u[B]$ ï¼ˆ $\theta$ å‰é¢å®šä¹‰è¿‡äº†ï¼‰
- å¦‚æœ $P$ æ˜¯å…¬å¼ï¼Œé‚£ä¹ˆ $\lnot P$ ä¹Ÿæ˜¯å…¬å¼
- å¦‚æœ $P1,P2$ æ˜¯å…¬å¼ï¼Œé‚£ä¹ˆ $P1 \land P2$ å’Œ  $P1 \lor P2$ ä¹Ÿæ˜¯å…¬å¼
- å¦‚æœ $P(t)$ æ˜¯å…¬å¼ï¼Œ$E$ æ˜¯å…³ç³»ï¼Œé‚£ä¹ˆ $\exists (t\in R)(P(t))$ å’Œ $\forall (t\in R)(P(t))$ ä¹Ÿæ˜¯å…¬å¼
- åŠ æ‹¬å¼§ä¹Ÿæ˜¯å…¬å¼
- è¿ç®—ç¬¦ä¼˜å…ˆé¡ºåºï¼šæ‹¬å¼§ã€$\theta, \exists, \forall, \lnot, \land, \lor$
- å…¬å¼ä»…é™ä»¥ä¸Šå½¢å¼



### å…³ç³»åŸŸæ¼”ç®—

åŸºæœ¬å½¢å¼ï¼š$$\{ (x_1, x_2,..., x_n) \mid P(x_1, x_2,..., x_n)\}$$ï¼Œå®ƒæ˜¯ä»¥åŸŸä¸ºåŸºæœ¬å•ä½çš„ã€‚å…¶å®šä¹‰ä¸å…³ç³»å…ƒç»„è¿ç®—åŸºæœ¬ä¸€æ ·ã€‚


**åŸŸæ¼”ç®—è¯­è¨€**ï¼ˆQBEï¼ŒQuery By Exampleï¼‰
- 1975å¹´æå‡ºï¼Œ1978å¹´å®ç°
- è¿™ä¸ªè¯­è¨€æ˜¯æŠŠæŸ¥è¯¢æ¡ä»¶å†™åˆ°è¡¨æ ¼ä¸­çš„
- ï¼ˆå¤ªè€äº†ï¼Œè¿™ä¸ªè¯­è¨€ï¼Œä¸ç»†å†™äº†ï¼‰


### å…³ç³»è¿ç®—çš„è§‚ç‚¹

**å®‰å…¨æ€§**ï¼šä¸äº§ç”Ÿæ— é™å…³ç³»å’Œæ— ç©·éªŒè¯çš„è¿ç®—ï¼Œå«åšå®‰å…¨çš„
- å…³ç³»ä»£æ•°æ˜¯ä¸€ç§é›†åˆè¿ç®—ï¼Œæ˜¯å®‰å…¨çš„ã€‚
    - é›†åˆæœ¬èº«æ˜¯æœ‰é™çš„ï¼Œè¿ç®—æ¬¡æ•°æ˜¯æœ‰é™çš„ï¼Œå› æ­¤å…³ç³»ä»£æ•°æ˜¯æœ‰é™çš„ã€‚
- å…³ç³»æ¼”ç®—ä¸ä¸€å®šå®‰å…¨
    - $$\{ t \mid \lnot R(t) \}$$ å¯èƒ½è¡¨ç¤ºæ— é™å…³ç³»ï¼Œå› ä¸ºä¸åœ¨ $R(t)$ ä¸­çš„å…ƒç´ å¯èƒ½æ˜¯æ— é™çš„
    - $$\{ t \mid R(t) \lor t[2]>3 \}$$ ä¸æ˜¯å®‰å…¨çš„ï¼Œå› ä¸º $t[2]>3$ å¯èƒ½æ˜¯æ— é™çš„
    - å®‰å…¨çº¦æŸï¼šæ–½åŠ ä¸€ä¸ªçº¦æŸæ¡ä»¶ï¼Œä½¿ä»»ä½•å…¬å¼éƒ½åœ¨ä¸€ä¸ªé›†åˆèŒƒå›´å†…æ“ä½œï¼ˆè€Œä¸æ˜¯æ— é™èŒƒå›´ï¼‰ã€‚å®‰å…¨çº¦æŸæœ‰é™é›†åˆ **DOM**



å…³ç³»è¿ç®—æœ‰3ç§ï¼šå…³ç³»ä»£æ•°ã€å…³ç³»å…ƒç»„æ¼”ç®—ã€å…³ç³»åŸŸæ¼”ç®—
- ä¸‰ç§è¿ç®—ä¹‹é—´æ˜¯ç­‰ä»·çš„ï¼šå…³ç³»ä»£æ•°ã€å®‰å…¨çš„å…ƒç»„æ¼”ç®—è¡¨è¾¾å¼ã€å®‰å…¨çš„åŸŸæ¼”ç®—è¡¨è¾¾å¼ï¼Œä¸‰ä¸ªæ˜¯ç­‰ä»·çš„
- 3ç§å…³ç³»è¿ç®—ï¼Œæ˜¯è¡¡é‡ **æ•°æ®åº“è¯­è¨€å®Œå¤‡æ€§çš„åŸºç¡€**


## SQL



SQL ç³»åˆ—æ–‡ç« ï¼š
- [ğŸ”¥ã€SQLã€‘SELECTä¸“é¢˜](https://www.guofei.site/2018/03/20/sqlselect.html)ï¼Œä¸»è¦å†…å®¹æ˜¯ SELECT è¯­å¥
- [ã€SQLã€‘é€šç”¨è¯­æ³•](https://www.guofei.site/2015/02/03/SQL.html)ï¼Œä¸»è¦å†…å®¹æ˜¯ CREATEã€ALTERã€INSERT ç­‰é€šç”¨çš„ SQL è¯­æ³•
- [å„ç§æ•°æ®åº“æ–¹è¨€](https://www.guofei.site/2015/01/30/mySQL.html)ï¼Œå„ç§æ•°æ®åº“çš„ç›¸å…³å‘½ä»¤ï¼Œå¦‚ HIVEã€MySQLã€SQL Server
- [ã€pythonã€‘sqlAlchemy](https://www.guofei.site/2018/03/21/sqlalchemy.html)


## æ•°æ®åº“å®Œæ•´æ€§

æ•°æ®åº“å®Œæ•´æ€§ï¼ˆDB Integrityï¼‰
- **å¹¿ä¹‰å®Œæ•´æ€§**ï¼šè¯­ä¹‰å®Œæ•´æ€§ã€å¹¶å‘æ§åˆ¶ã€å®‰å…¨æ§åˆ¶ã€æ•…éšœæ¢å¤
- **ç‹­ä¹‰å®Œæ•´æ€§**ï¼šæŒ‡çš„æ˜¯è¯­ä¹‰å®Œæ•´æ€§

å…³ç³»æ¨¡å‹ä¸­çš„å®Œæ•´æ€§ï¼š
- å®ä½“å®Œæ•´æ€§
- å‚ç…§å®Œæ•´æ€§
- ç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´æ€§

å¼•å‘å®Œæ•´æ€§é—®é¢˜çš„åŸå› ï¼šä¸æ­£ç¡®çš„æ•°æ®åº“æ“ä½œï¼šè¾“å…¥é”™è¯¯ã€æ“ä½œå¤±è¯¯ã€ç¨‹åºå¤„ç†å¤±è¯¯
- å¦‚ä½•åº”å¯¹ï¼š
    - é˜²æ­¢æ•°æ®åº“ä¸­å‡ºç°ä¸åˆç†çš„æ•°æ®
    - DBMS å°½å¯èƒ½é˜²æ­¢ DB ä¸­çš„è¯­ä¹‰ä¸åˆç†ç°è±¡
- DBMS å¦‚ä½•ä¿è¯å®Œæ•´æ€§ï¼š
    - DBMS å…è®¸ç”¨æˆ·è‡ªå®šä¹‰çº¦æŸè§„åˆ™ï¼ˆSQL-DDLï¼‰
    - æœ‰æ›´æ–°æ“ä½œæ—¶ï¼ŒDBMS å…ˆè‡ªåŠ¨æŒ‰å®Œæ•´æ€§çº¦æŸè¿›è¡Œæ£€æŸ¥ï¼Œç„¶åæ›´æ–°æ•°æ®åº“


å®Œæ•´æ€§çº¦æŸçš„ä¸€èˆ¬å½¢å¼ï¼š **Integrity Constraint = (O, P, A, R)**
- O:æ•°æ®é›†åˆï¼ˆçº¦æŸçš„å¯¹è±¡ï¼‰ï¼Œåˆ—ã€å¤šåˆ—ã€å…ƒç»„ç­‰
    - æŒ‰çº¦æŸå¯¹è±¡åˆ’åˆ†
        - åŸŸå®Œæ•´æ–°çº¦æŸï¼šç»™å®šåˆ—ï¼Œå…¶å€¼è¦æ»¡è¶³çº¦æŸæ¡ä»¶ï¼Œä¾‹å¦‚è§„å®š age è¦åœ¨0-150ä¹‹é—´
        - å…³ç³»å®Œæ•´æ€§çº¦æŸï¼šæŸä¸€å…ƒç»„è¦æ»¡è¶³çº¦æŸæ¡ä»¶ï¼Œæˆ–è€…è‹¥å¹²å…ƒç»„ä¸å¦ä¸€ä¸ªå…³ç³»è‹¥å¹²å…ƒç»„ä¸€èµ·æ»¡è¶³çº¦æŸæ¡ä»¶ï¼Œä¾‹å¦‚è§„å®š å­¦æ—¶é™¤ä»¥å­¦åˆ†è¦åœ¨ 6-7ä¹‹é—´
    - æŒ‰ç…§çº¦æŸæ¥æºåˆ†ç±»
        - ç»“æ„çº¦æŸï¼šå‡½æ•°ä¾èµ–ã€ä¸»é”®ã€å¤–é”®ã€æ˜¯å¦å…è®¸ç©ºå€¼
        - å†…å®¹çº¦æŸï¼šç”¨æˆ·è‡ªå®šä¹‰çš„èŒƒå›´ï¼Œå¦‚ age
    - æŒ‰ç…§çº¦æŸçŠ¶æ€åˆ†
        - é™æ€çº¦æŸï¼šæ»¡è¶³çš„å›ºå®šæ¡ä»¶ï¼Œå¦‚ä¸€ä¸ªèŒƒå›´
        - åŠ¨æ€çº¦æŸï¼šä¾‹å¦‚ age åªèƒ½å‡ï¼Œä¸èƒ½é™ã€‚**ç”¨è§¦å‘å™¨å®ç°**
- P:è°“è¯æ¡ä»¶ï¼ˆä»€ä¹ˆæ ·çš„çº¦æŸï¼‰
- A:è§¦å‘æ¡ä»¶ï¼ˆä»€ä¹ˆæ—¶å€™æ£€æŸ¥ï¼‰
- R:ç›¸åº”åŠ¨ä½œï¼ˆä¸æ»¡è¶³æ—¶æ€ä¹ˆåŠï¼‰

### é™æ€çº¦æŸ

**é™æ€çº¦æŸç”¨ CREATE è¯­å¥å®ç°**
```sql
CREATE TABLE tablename(
    colname1 datatype [ DEFAULT { default_constant | NULL} ]
        [ col_constr {col_constr. . .} ] -- å­—æ®µçº§åˆ«çº¦æŸ
    ,colname2 datatype
    ,...
    -- ä»¥ä¸‹æ˜¯è¡¨çº§åˆ«çº¦æŸ
    ,table_constr1
    ,table_constr2
);


-- å­—æ®µçº§åˆ«çº¦æŸçš„å†™æ³•
{ NOT NULL |                               -- åˆ—å€¼éç©º
    [ CONSTRAINT constraintname]           -- ä¸ºçº¦æŸå‘½åï¼Œä¾¿äºä»¥åæ’¤æ¶ˆ
        { UNIQUE                           -- åˆ—å€¼æ˜¯å”¯ä¸€
        | PRIMARY KEY                      -- åˆ—ä¸ºä¸»é”®
        | CHECK (search_cond)              -- åˆ—å€¼æ»¡è¶³æ¡ä»¶ï¼Œsearch_cond çš„å†™æ³•ä¸ SQL çš„ WHERE å†™æ³•ä¸€æ ·ï¼Œä½†åªä½œç”¨äºå•åˆ—
        | REFERENCES tablename [(colname) ] -- åˆ—æ˜¯å¤–é”®ï¼Œéœ€è¦æŒ‡å®šå®ƒæ˜¯å“ªä¸ªè¡¨çš„ä¸»é”®
            [ON DELETE { CASCADE | SET NULL } ] } } -- å¯¹åº”è¡¨çš„è®°å½•è¢«åˆ é™¤æ—¶ï¼Œè¿™ä¸ªè¡¨å¯¹åº”çš„è¡Œ åˆ é™¤/ç½®ä¸º NULL

-- ä¸€ä¸ªå­—æ®µçº§çº¦æŸä¾‹å­ï¼š
CREATE Table Student ( 
    S# char(8) not null unique                           -- åˆ—éç©ºã€å”¯ä¸€
    ,Sname char(10)
    ,Ssex char(2) 
        CONSTRAINT ctssex CHECK (Ssex=â€˜ç”·â€™ or Ssex=â€˜å¥³â€™) -- çº¦æŸçš„åå­—ä¸º "ctssex"
    ,Sage integer CHECK (Sage>=1 and Sage<150)          -- å¯¹ Sage å­—æ®µçš„çº¦æŸ
    ,D# char(2) REFERENCES Dept(D#) ON DELETE CASCADE   -- å®ƒæ˜¯å¤–é”®ï¼Œå¯¹åº”è¡¨ Dept çš„ D# å­—æ®µï¼Œå¹¶ä¸”å¦‚æœ Dept çš„è®°å½•è¢«åˆ é™¤ï¼Œæ­¤è¡¨å¯¹åº”çš„è®°å½•ä¹Ÿåˆ é™¤
    ,Sclass char(6)
);




-- è¡¨çº§åˆ«çº¦æŸçš„å†™æ³•ï¼š
[CONSTRAINT constraintname] -- ä¸ºçº¦æŸå‘½åï¼Œä¾¿äºä»¥åæ’¤æ¶ˆ
    {UNIQUE (colname {, colname. . .})           -- å‡ åˆ—å€¼ç»„åˆåœ¨ä¸€èµ·æ˜¯å”¯ä¸€
    | PRIMARY KEY (colname {, colname. . .})     -- å‡ åˆ—è”åˆä¸ºä¸»é”®
    | CHECK (search_condition)                   -- å…ƒç»„å¤šåˆ—å€¼å…±åŒæ»¡è¶³æ¡ä»¶
    | FOREIGN KEY (colname {, colname. . .})
        REFERENCES tablename [(colname {, colname. . .})]
        [ON DELETE CASCADE] }
        -- å¼•ç”¨å¦ä¸€è¡¨tablenameçš„è‹¥å¹²åˆ—çš„å€¼ä½œä¸ºå¤–é”®


-- ä¸€ä¸ªè¡¨çº§åˆ«çº¦æŸçš„ä¾‹å­ï¼š
Create Table Course (
    C# char(3)
    ,Cname char(12)
    ,Chours integer
    ,Credit float(1) CONSTRAINT ctcredit CHECK(Credit >=0.0 and Credit<=5.0)           -- ä»ç„¶å¯ä»¥åšå­—æ®µçº§åˆ«çº¦æŸ
    ,T# char(3)
    ,primary key(C#)       -- è¡¨çº§åˆ«çº¦æŸ
    ,FOREIGN KEY(T#) REFERENCES Teacher(T#) ON DELETE CASCADE -- è¡¨çº§åˆ«çº¦æŸ
    ,constraint ctcc check(Chours/Credit = 20)  --è¡¨çº§åˆ«çº¦æŸ
);
```

**çº¦æŸæ¡ä»¶å¯ä»¥æ˜¯ WHERE ä¹‹åçš„è¯­å¥**ï¼Œä¾‹å¦‚ï¼š
```sql
CREATE TABLE SC(
    S# char(8) check( S# in (select S# from student)), -- çº¦æŸæ¡ä»¶æ˜¯ä¸€ä¸ªå­æŸ¥è¯¢
),
```


ALTER TABLE ä¹Ÿæœ‰ç±»ä¼¼çš„ç”¨æ³•ï¼ˆå‡ ä¹ä¸ CREATE ä¸€æ ·ï¼‰ï¼š

```sql
ALTER TABLE tblname
    -- å¢åŠ åˆ—çš„åŒæ—¶ï¼Œå¯ä»¥åŠ å…¥çº¦æŸ
    [ADD ( { colname datatype [DEFAULT {default_const|NULL} ]
        [col_constr {col_constr...} ] | , table_constr }
        {, colname ...}) ]
    -- åˆ é™¤ä¸€ä¸ªåˆ—
    [DROP { COLUMN columnname | (columnname {, columnnameâ€¦})}] 
    -- ä¿®æ”¹ä¸€ä¸ªåˆ—çš„åŒæ—¶ï¼Œä¿®æ”¹å…¶çº¦æŸ
    [MODIFY ( columnname data-type
        [DEFAULT {default_const | NULL } ] [ [ NOT ] NULL ]
        {,columnname . . .})]
    -- å¢åŠ ä¸€ä¸ªçº¦æŸ
    [ADD CONSTRAINT constr_name]
    -- åˆ é™¤ä¸€ä¸ªçº¦æŸ
    [DROP CONSTRAINT constr_name]
    [DROP PRIMARY KEY];

-- ä¾‹å­1ï¼š
ALTER TABLE SC DROP CONSTRAINT ctscore;

-- ä¾‹å­2
ALTER TABLE SC
    MODIFY ( Score float(1) CONSTRAINT nctscore CHECK (Score>=0.0 and Score<=150.0) );
```


**ç¬¬äºŒç§çº¦æŸçš„å†™æ³•ï¼šæ–­è¨€ï¼ˆASSERTIONï¼‰**ï¼Œæ ¼å¼ä¸º `CREATE ASSERTION <assertion-name> CHECK <predicate>`ï¼Œå½±å“æ€§èƒ½ï¼Œç”¨çš„ä¸å¤šï¼Œä¸å†™äº†ã€‚



### åŠ¨æ€çº¦æŸ

åŠ¨æ€çº¦æŸç”¨ **è§¦å‘å™¨ï¼ˆTRIGGERï¼‰** å®ç°


```sql
CREATE TRIGGER trigger_name BEFORE | AFTER -- äº‹ä»¶å‘ç”Ÿå‰/å
    {INSERT | DELETE | UPDATE [OF colname {, colname...}]} -- äº‹ä»¶æ˜¯ä»€ä¹ˆ
    ON tablename 
    [REFERENCING corr_name_def {, corr_name_def...} ]  -- å®šä¹‰å˜æ›´å‰åçš„å˜é‡åï¼Œæ–¹ä¾¿åœ¨ statement ä¸­ä½¿ç”¨
    [FOR EACH ROW | FOR EACH STATEMENT]    -- å¯¹æ¯ä¸€è¡Œï¼Œå¯¹æ¯æ¬¡æ“ä½œ
    [WHEN (search_condition)]              --æ£€æŸ¥æ¡ä»¶ï¼Œå¦‚æ»¡è¶³æ‰§è¡Œä¸‹è¿°ç¨‹åº
        {statement                         -- æ‰§è¡Œå•è¡Œç¨‹åºï¼Œç›´æ¥ä¹¦å†™
        | BEGIN statement1; statement2;... END -- å¦‚æœæ‰§è¡Œå¤šè¡Œè¯­å¥ï¼Œè¦åŠ  BEGIN å’Œ END
        }

-- ä¸€ä¸ªä¾‹å­ï¼šè§„å®šå·¥èµ„åªèƒ½ä¸Šè°ƒï¼Œä¸èƒ½ä¸‹è°ƒ
CREATE TRIGGER teacher_chgsal BEFORE  
    UPDATE OF salary
    ON table_teacher
    REFERENCING new x, old y -- å®šä¹‰æ–°/æ—§å€¼ï¼Œæ–¹ä¾¿åœ¨ä¸‹é¢ä½¿ç”¨
    FOR each ROW
    WHEN(x.salary < y.salary) -- æ£€æŸ¥æ¡ä»¶
    BEGIN
        -- statement å¯ä»¥æ˜¯ä¸€ä¸ª SQL-UPDATE/DELETE ç­‰è¯­å¥
        raise_application_error(-20003, 'invalid salary on update');
    END;
```


å…¶å®ƒ

```sql
-- æ˜¾ç¤ºè§¦å‘å™¨
SHOW TRIGGERS;

-- åˆ é™¤è§¦å‘å™¨
DROP TRIGGER trigger_name
```


## æ•°æ®åº“å®‰å…¨æ€§


æ•°æ®åº“å®‰å…¨æ€§æŒ‡çš„æ˜¯DBMSåº”è¯¥ä¿è¯æ•°æ®åº“çš„ä¸€ç§ç‰¹æ€§ï¼šå…å—éæ³•ã€éæŠ½åˆ¸ç”¨æˆ·çš„ä½¿ç”¨ã€æ³„éœ²ã€æ›´æ”¹ã€ç ´å

DBMS çš„å®‰å…¨æœºåˆ¶
- è‡ªä¸»å®‰å…¨æœºåˆ¶ï¼šç”¨æˆ·è‡ªå·±åš Access Controlï¼Œæƒé™åœ¨ç”¨æˆ·ä¹‹é—´ä¼ æ’­
- å¼ºåˆ¶å®‰å…¨æœºåˆ¶ï¼šå¯¹æ•°æ®ã€ç”¨æˆ·åˆ†ç±»åˆ†çº§ï¼Œä¸åŒç±»åˆ«çš„ç”¨æˆ·å¯ä»¥è®¿é—®ä¸åŒç±»åˆ«çš„æ•°æ®
- æ¨æ–­æ§åˆ¶ï¼šé˜²æ­¢é€šè¿‡å†å²ä¿¡æ¯ã€å…¬å¼€ä¿¡æ¯ï¼Œæ¨æ–­å‡ºç§å¯†ä¿¡æ¯
- æ•°æ®åŠ å¯†å­˜å‚¨


è‡ªä¸»å®‰å…¨æœºåˆ¶ï¼Œä½¿ç”¨ **SQL-DCL**ï¼Œè§„åˆ™æ˜¯ **Access Rule = (S, O, t, P)**
- S:è¯·æ±‚ä¸»ä½“ï¼ˆç”¨æˆ·ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·ç»„
- O:è®¿é—®å¯¹è±¡ï¼Œç²’åº¦å¯å¤§å¯å°ï¼Œä¾‹å¦‚å­—æ®µï¼ˆå±æ€§ï¼‰ã€è®°å½•ï¼ˆå…ƒç»„ï¼‰ã€è¡¨ï¼ˆå…³ç³»ï¼‰ã€æ•°æ®åº“
- t:è®¿é—®æƒåˆ©ï¼Œåˆ›å»ºã€å¢ã€åˆ ã€æ”¹ã€æŸ¥
- P:æ‹¥æœ‰æƒåŠ›éœ€æ»¡è¶³çš„æ¡ä»¶ï¼Œä¾‹å¦‚ä»…å‘˜å·¥å…è®¸è®¿é—®è‡ªå·±çš„æ•°æ®

ã€ä¾‹å­ã€‘ä¸€ä¸ªå‘˜å·¥æ•°æ®åº“ï¼Œå®‰å…¨æ€§è¦æ±‚ï¼š
- å‘˜å·¥ç®¡ç†äººå‘˜ï¼šéœ€è¦æ‰€æœ‰çš„è¯»å†™æƒé™
- æ”¶å‘äººå‘˜ï¼šè®¿é—®å‘˜å·¥ã€éƒ¨é—¨ï¼Œä¸å…è®¸è®¿é—®å…¶å®ƒä¿¡æ¯
- æ¯ä¸ªå‘˜å·¥ï¼šåªå…è®¸è®¿é—®è‡ªå·±çš„è®°å½•ï¼Œå¯ä»¥æŸ¥è¯¢å·¥èµ„
- éƒ¨é—¨é¢†å¯¼ï¼šæŸ¥è¯¢æ‰€åœ¨éƒ¨é—¨æ‰€æœ‰äººçš„æƒ…å†µ


**SQL-DCL**

æ•°æ®åº“æƒé™åˆ†çº§ï¼ˆé«˜ç­‰çº§è‡ªåŠ¨åŒ…å«ä½ç­‰çº§æƒé™ï¼‰ï¼š
1. SELECTï¼šè¯»
2. MODIFYï¼šåŒ…æ‹¬ INSERTã€UPDATEã€DELETE
3. CREATEï¼šCREATEã€ALTERã€DROP

```sql
-- æˆäºˆæƒé™
GRANT {ALL PRIVILEGES | privilege {,privilegeâ€¦}}
ON [TABLE] tablename | viewname
TO {public | user-id {, user-idâ€¦}}
[WITH GRANT OPTION];         -- æ˜¯å¦å…è®¸è¯¥ç”¨æˆ·æŠŠæƒé™æˆäºˆå¦ä¸€ä¸ªç”¨æˆ·

-- ä¾‹å­
GRANT select ON table_employee TO user1 WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON table_employee TO user2;
GRANT select ON table_employee TO public;



-- æ”¶å›æƒé™
REVOKE {all privilEges | priv {, privâ€¦} } ON tablename | viewname
FROM {public | user {, userâ€¦} }
```


**ç¬¬äºŒç§è®¿é—®æ§åˆ¶æ‰‹æ®µï¼šVIEW**


## åµŒå…¥å¼SQL

æ˜¯ä»€ä¹ˆï¼ŸæŠŠ SQL æ½œå…¥åˆ°é«˜çº§è¯­è¨€ï¼ˆC/C++/Java/Pythonï¼‰ä¸­

ä¸ºä»€ä¹ˆï¼Ÿ
1. å¤æ‚çš„æŸ¥è¯¢ï¼Œæ™®é€šç”¨æˆ·å¯èƒ½å†™ä¸å¯¹
2. ä¸€äº›å¤æ‚çš„ç»“æœéš¾ä»¥ç”¨ä¸€æ¡ SQL å®Œæˆï¼Œ
    - ä¾‹å¦‚å¾ªç¯ï¼š`Do While some-condition SQL-Query End Do`
    - IF è¯­å¥
    - åœ¨ SQL ç»“æœä¸Šç»§ç»­å¤„ç†


C è¯­è¨€ä¸ºä¾‹ï¼š
```c
EXEC SQL select Sname, Sage into :vSname, :vSage from Student
where Sname=â€˜å¼ ä¸‰â€™;
```

è§£é‡Šï¼š
- `EXEC SQL`: æŠŠ SQL é¢„ç¼–è¯‘ä¸º C å¯è¯†åˆ«çš„è¯­å¥
- å¢åŠ  `into` å­å¥ï¼šæŠŠ SQL æ£€ç´¢ç»“æœï¼ŒæŒ‡å®šç»™ C çš„å˜é‡



**æ•°æ®åº“çš„è¿æ¥ä¸æ–­å¼€**ï¼Œ**å˜é‡çš„å£°æ˜ä¸ä½¿ç”¨**

```c
// è¿æ¥æ•°æ®åº“ï¼Œä¸‹é¢æ˜¯æ ‡å‡†è¯­æ³•ã€‚æ¯ç§æ•°æ®åº“è¿˜æä¾›ä¸åŒçš„è¯­æ³•
EXEC SQL connect to sql_server_name as connect_name user user_name;

// å®šä¹‰å˜é‡
EXEC SQL BEGIN DECLARE SECTION;
    char vSname[10], specName[10]="å¼ ä¸‰";
    int vSage;
EXEC SQL END DECLARE SECTION;

// SQL è¯­å¥
EXEC SQL SELECT name, age into :v_name, :v_age from
table_student where name= :specName;

// æœ€åæ–­å¼€è¿æ¥ï¼ˆæ¯ç§æ•°æ®åº“æä¾›ä¸åŒçš„è¯­æ³•ï¼‰
EXEC SQL disconnect connect-name;
```


### äº‹åŠ¡

**SQL çš„æäº¤ä¸æ’¤é”€**

```c
// æäº¤
EXEC SQL COMMIT WORK;

// æ’¤é”€
EXEC SQL ROLLBACK WORK;
```

ä¸ºä»€ä¹ˆéœ€è¦æäº¤ä¸æ’¤é”€ï¼Ÿ
- ä»£ç å¦‚ä½•è¡¨ç¤ºäº‹åŠ¡ï¼šå¯ä»¥ç”¨ `Begin Transaction` å’Œ `End Transaction` æŠŠä¸€ä¸ªäº‹åŠ¡æ¡†èµ·æ¥ã€‚ä¹Ÿå¯ä»¥ç”±ä»£ç æ ¹æ® `EXEC SQL COMMIT/ROLLBACK WORK` è‡ªåŠ¨åˆ’åˆ†
- ä¸€ä¸ªä¾‹å­ï¼šA å‘ B è½¬è´¦ 500å…ƒï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š
    1. æ£€æŸ¥ A çš„è´¦æˆ·ä½™é¢ï¼Œ
    2. A è´¦æˆ·æ‰£é™¤ 500å…ƒ
    3. B è´¦æˆ·åŠ  500å…ƒ



äº‹åŠ¡çš„ç‰¹æ€§ï¼š**ACID**
- **åŸå­æ€§**(Atomicity)ï¼šæ•´ä¸ªäº‹åŠ¡æ˜¯åŸå­ã€ä¸å¯åˆ†çš„ã€‚ä¸€ä¸ªäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨commitæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥å…¨éƒ¨rollbackã€‚å¯¹äºä¸€ä¸ªäº‹åŠ¡æ¥è¯´ï¼Œä¸å¯èƒ½åªæ‰§è¡Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†SQLã€‚
    - ä¾‹å­ï¼šA å‘ B è½¬è´¦ 500å…ƒï¼Œåˆ†ä¸ºä¸¤æ­¥ï¼š1ï¼‰A è´¦æˆ·æ‰£æ¬¾ 500å…ƒï¼Œ2ï¼‰B è´¦æˆ·åŠ æ¬¾ 500å…ƒã€‚å¦‚æœä¸¤æ­¥ä¹‹é—´å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆAå’ŒBçš„ä½™é¢éƒ½æ¢å¤åˆ°åŸå§‹çŠ¶æ€ã€‚
- **ä¸€è‡´æ€§(Consistency)**ï¼šæ•°æ®åº“æ€»æ˜¯ä»ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€è½¬æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€ã€‚äº‹åŠ¡ä¸èƒ½ç ´åæ•°æ®åº“çš„çº¦æŸæ¡ä»¶ï¼Œä¾‹å¦‚ä¸»é”®ã€å¤–é”®ã€ç”¨æˆ·è‡ªå®šä¹‰CHECKï¼ˆå¦‚ï¼Œä½™é¢ä¸èƒ½ä¸ºè´Ÿï¼‰ã€‚
- **éš”ç¦»æ€§(Isolation)**ï¼šå¹¶å‘æ‰§è¡Œçš„å¤šä¸ªäº‹åŠ¡ä¹‹é—´ç›¸äº’éš”ç¦»ã€‚ä¸€ä¸ªäº‹åŠ¡åœ¨æäº¤ä»¥å‰ï¼Œå¯¹æ•°æ®åº“çš„ä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ã€‚
- **æŒä¹…æ€§(Durability)**ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°±ä¼šæ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚æ­¤æ—¶å³ä½¿ç³»ç»Ÿå´©æºƒï¼Œä¿®æ”¹çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚




ä¸€æ®µå…³äºäº‹åŠ¡çš„ Cè¯­è¨€ä»£ç 

```c
#include <stdio.h>
#include "prompt.h"

// sqlca æ˜¯é”™è¯¯å¤„ç†æ‰€ç”¨çš„åŒºåŸŸ
EXEC SQL include sqlca;

char cid_prompt[ ] = "Please enter customer id:	";
int main(){

    // å®šä¹‰å˜é‡
    EXEC SQL BEGIN DECLARE SECTION;
        char cust_id[5], cust_name[14];
        float cust_discnt;
        char user_name[20],user_pwd[20];
    EXEC SQL END DECLARE SECTION;
    
    // SQL é”™è¯¯æ•è·è¯­å¥
    EXEC SQL whenever sqlerror goto report_error;
    EXEC SQL whenever not found goto notfound;
    
    // è¿æ¥æ•°æ®åº“
    strcpy(user_name, "poneilsql");
    strcpy(user_pwd, "XXXX");
    EXEC SQL connect :user_name	identified by :user_pwd;
    
    // ä¸»è¦é€»è¾‘
    while((prompt(cid_prompt,1,cust_id,4)) >=0) {
        EXEC SQL select cname,discnt
            into :cust_name, :cust_discnt
            from customers where cid=:cust_id;
        EXEC SQL commit work;
        printf("Customerâ€™s name is %s and discount is %5.1f\n", cust_name, cust_discnt);
        continue;
    }

    // å®šä¹‰è¿™äº›é”™è¯¯
    notfound: 
        printf("Canâ€™t find customer %s, continuing\n", cust_id);
        EXEC SQL commit release;
        return 0;
    
    report_error:
        print_dberror();
        EXEC SQL rollback release;
        return 1;
}
```

### æ¸¸æ ‡

æ¸¸æ ‡ï¼ˆCursorï¼‰çš„åŸå› ï¼šSQL è¿”å›ç»“æœæ˜¯å•è¡Œæ—¶å¯ä»¥ç›´æ¥ä¼ ç»™Cè¯­è¨€çš„å˜é‡ï¼Œä½†æ˜¯å¦‚æœè¿”å›å¤šè¡Œç»“æœï¼Œåˆ™éœ€è¦ä½¿ç”¨ Cursor
- Cursor æ˜¯æŒ‡å‘è®°å½•çš„æŒ‡é’ˆ
- æŒ‡é’ˆç§»åŠ¨ï¼ŒæŒ‡å‘ä¸€è¡Œã€‚ä¸€è¡Œä¸€è¡Œå¤„ç†ï¼Œæœ€åå…³é—­ã€‚



```c
// å®šä¹‰ä¸€ä¸ª cursor å¹¶å‘½åä¸º cursor_student
EXEC SQL DECLARE cursor_student CURSOR FOR
SELECT id, name, class FROM table_student WHERE class = '101';

// æ‰“å¼€ cursor
EXEC SQL open cursor_student;

// å–å‡ºä¸€æ¡æ•°æ®ï¼Œå°†å…¶å†…å®¹æ”¾å…¥å˜é‡ä¸­
EXEC SQL FRTCH cursor_student INTO :v_id, :v_name, :v_class;
...


// å…³é—­ cursor
EXEC SQL CLOSE cursor_student;
```

è¯´æ˜
- cursor å¯ä»¥å¤šæ¬¡æ‰“å¼€/å…³é—­
- cursor åªèƒ½ä»ä¸Šåˆ°ä¸‹ç§»åŠ¨ã€‚å¤§å¤šæ•° DBMS ä¸æ”¯æŒ cursor å‘ä¸Šç§»åŠ¨ï¼ˆæ”¯æŒçš„å«åš **å¯æ»šåŠ¨æ¸¸æ ‡**ï¼‰ï¼Œåªèƒ½å†æ¬¡è®¿é—®éœ€è¦å…³é—­åé‡æ–°æ‰“å¼€ã€‚
- å¯ä»¥é€šè¿‡ ODBCï¼ˆOpen DataBase Connectivityï¼‰é€šç”¨æ¥å£æ”¯æŒå¯æ»šåŠ¨æ¸¸æ ‡

### æ•°æ®çš„åˆ ã€æ”¹ã€æ’

ä¸¤ç§æ–¹æ³•ï¼š1ï¼‰ä½¿ç”¨ SQL è¯­å¥ï¼Œ2ï¼‰ä½¿ç”¨ cursor

```c
// ä½¿ç”¨ sql è¯­å¥åˆ é™¤
EXEC DELETE FROM tabltable_student WHERE ...;

// ä½¿ç”¨ sql æ›´æ–°
EXEC SQL UPDATE tabltable_student SET ...;

// ä½¿ç”¨ sql æ’å…¥
EXEC SQL INSERT INTO tabltable_student(id, name, class) ...;

// ä½¿ç”¨ cursor åˆ é™¤/æ›´æ–°
EXEC SQL DECLARE cursor_student CURSOR FOR
SELECT id, name, class from table_student WHERE class = '101'
FOR UPDATE OF class // FOR UPDATE: åˆ é™¤/æ›´æ–°ï¼›FOR READ ONLY
;

EXEC SQL OPEN cursor_student; // å®é™…æ‰§è¡Œ SQL æ˜¯åœ¨ OPEN é˜¶æ®µè¿›è¡Œçš„
while(1){
    EXEC SQL FETCH cursor_student INTO :cust_id;
    if(rand()>0.3){
        // åˆ é™¤
        EXEC SQL DELETE FROM table_student WHERE CURRENT OF cursor_student;
    }else{
        // æ›´æ–°
        EXEC SQL UPDATE SET class='102' WHERE CURRENT OF cursor_student;
    }
}

EXEC SQL CLOSE cursor_student;
```

### é”™è¯¯å¤„ç†





## å‚è€ƒèµ„æ–™



å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦ï¼šæ•°æ®åº“ç³»ç»Ÿ [https://www.icourse163.org/learn/HIT-1001516002](https://www.icourse163.org/learn/HIT-1001516002)


é™†å†›å·¥ç¨‹å¤§å­¦ï¼šæ•°æ®åº“åŸç†ä¸åº”ç”¨ [https://www.icourse163.org/course/PAEU-1003647009](https://www.icourse163.org/course/PAEU-1003647009)



