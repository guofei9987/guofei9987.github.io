---
layout: post
title: ğŸ”¥ã€Dockerã€‘è¯­æ³•é€ŸæŸ¥
categories:
tags: 0x11_ç®—æ³•å¹³å°
keywords:
description:
order: 141
permalink: /:title:output_ext
---

*æ³¨ï¼š*
- *dockerä¸­ï¼ŒåŒä¸€åŠŸèƒ½çš„å‘½ä»¤å¾€å¾€æœ‰å¤šç§ï¼Œè¿™é‡Œåªåˆ—å‡ºæŸä¸€é£æ ¼çš„å‘½ä»¤ï¼ŒåŸåˆ™æ˜¯å¥½è®°ï¼Œä¸è¦åœ¨æ„èŒ´é¦™è±†æœ‰å‡ ç§å†™æ³•ã€‚ä¾‹å¦‚ï¼Œç”¨ `docker image rm [é•œåƒå]` åˆ é™¤é•œåƒï¼Œè€Œä¸æ˜¯ `docker rmi [é•œåƒå]`*
- *docker å‘½ä»¤è®¾è®¡çš„éå¸¸å¥½ï¼Œä»¥è‡³äºè¿™ç¯‡æ–‡ç« å¯ä»¥å¾ˆç®€ä»‹ï¼Œä¾‹å¦‚ï¼Œä»¥ä¸‹æ‰€æœ‰ç”¨åˆ° `container_id` çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥æ¢æˆ `container_name`; æ‰€æœ‰ç”¨åˆ° `image_id` çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥æ¢æˆ `image_name`*


## ç®€ä»‹
Dockerä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ  
1. Imageï¼šä¸€ç»„æ–‡ä»¶ï¼Œåˆ†å±‚æ„å»º
2. Containerï¼šæ˜¯Imageçš„ä¸€ä¸ªå®ä¾‹ï¼Œæœ‰è‡ªå·±çš„root/ç½‘ç»œ/è¿›ç¨‹ï¼Œå’Œ Image çš„å…³ç³»å¦‚åŒç±»å’Œå¯¹è±¡çš„å…³ç³»
3. Repositoryï¼šå­˜å‚¨ã€åˆ†å‘ Image çš„æœåŠ¡ï¼ˆä¾‹å¦‚ dockerhub https://hub.docker.com/ï¼‰ã€‚ä¸€ä¸ª Docker Registry  ä¸­åŒ…å«å¤šä¸ª Repositoryï¼Œæ¯ä¸ª Repository åŒ…å«å¤šä¸ª Tag ï¼Œæ¯ä¸ª Tag åŒ…å«ä¸€ä¸ªé•œåƒã€‚  

ç›¸å…³ç½‘ç«™
- [https://www.docker.com/](https://www.docker.com/)
- [https://hub.docker.com/](https://hub.docker.com/)


## å®¹å™¨çš„ä½¿ç”¨

å»ºç«‹ä¸€ä¸ªå®¹å™¨
```bash
docker run -it ubuntu bash
# è‹¥æœ¬åœ°æ²¡æœ‰è¯¥é•œåƒï¼Œåˆ™ä»è¿œç«¯ä¸‹è½½
docker run hub.c.163.com/library/hello-world:latest
docker run -it ubuntu:14.04 /bin/bash
docker run -it --name="my-container-name" --volume /Users/guofei/git/:/Users/guofei/git/ ubuntu bash
```

- `-it` ä¸€èˆ¬è¿åœ¨ä¸€èµ·ç”¨ã€‚iè¡¨ç¤ºè®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€ï¼Œtè¡¨ç¤ºè®©Dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯å¹¶ç»‘å®šåˆ°å®¹å™¨æ ‡å‡†è¾“å…¥ä¸Š
- `-d` åå°è¿è¡Œå®¹å™¨
- `--rm` é€€å‡ºæ—¶æ¸…é™¤æ–‡ä»¶ç³»ç»Ÿ
- `--name="my-container-name"` æŒ‡å®šä¸€ä¸ªåç§°
- `--volume /Users/guofei/git/:/Users/guofei/git/` æŒ‚è½½ç›®å½•
- `-p 127.0.0.1:4006:4000` ç«¯å£æ˜ å°„



æŸ¥çœ‹å®¹å™¨
```bash
# åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨
docker container ls

# åˆ—å‡ºæ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬Exitedï¼‰
docker container ls -a
```

å¯ç”¨å·²ç»ç»ˆæ­¢çš„ container
```bash
docker container start your_container_id
```

è¿›å…¥å®¹å™¨
```bash
docker run -d ubuntu /bin/sh -c "while true; do echo hello world; sleep 1; done"
# -d è®©Docker åå°è¿è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥å°†ç»“æœè¾“å‡ºåˆ°å½“å‰å®¿ä¸»æœºä¸‹
# ä¼šè¿”å›ä¸€ä¸ªid
docker container logs <id or container_id or name> # ç”¨æ¥æŸ¥çœ‹è¿”å›çš„ä¿¡æ¯
docker attach <id or container_id or name> # å¯¹äºåå°è¿è¡Œçš„å®¹å™¨ï¼Œè¿›å…¥å®¹å™¨ï¼ˆè¿›å»ä¹‹åè¿˜åœ¨printï¼‰
docker exec -it <container_id or name> bash # åŒæ ·æ˜¯è¿›å…¥å®¹å™¨ï¼ˆè¿›å»ä¹‹åä¸æ˜¾ç¤ºprintçš„å†…å®¹ï¼Œä½†åå°è¿˜æ˜¯ä¸€ç›´åœ¨printï¼‰
# docker start [CONTAINER_ID or CONTAINER_NAME]
```

åœæ­¢å®¹å™¨
```bash
docker stop your_container_id

# åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨
docker stop $(docker ps -q)
```

åˆ é™¤å®¹å™¨
```bash
docker container rm <container id>
docker container rm -f <name> # -f åˆ é™¤è¿è¡Œä¸­çš„ container
docker container prune # æ¸…é™¤æ‰€æœ‰ ç»ˆæ­¢çŠ¶æ€çš„ container

# åˆ é™¤æ‰€æœ‰å®¹å™¨
docker container rm $(docker container ls -aq)
# åˆ é™¤æ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬ running çŠ¶æ€çš„
docker container rm -f $(docker container ls -aq)
```

å®¹å™¨æ”¹å
```bash
docker rename container_name new_container_name
```


## ä¿å­˜

image çš„ä¿å­˜å’Œè½½å…¥ã€‚  
åº”ç”¨åœºæ™¯æ˜¯ï¼Œä½ è¦éƒ¨ç½²çš„ç›®æ ‡æœºå™¨ä¸èƒ½è¿å¤–ç½‘ï¼Œé‚£ä¹ˆç”¨ `docker save` æ‰“åŒ…ï¼Œç„¶åæ‹·è´åˆ°ç›®æ ‡æœºå™¨ä¸Šï¼Œç”¨`docker load` åˆ›å»ºé•œåƒã€‚
```bash
docker save -o images.tar postgres:9.6 mongo:3.4
docker load -i images.tar # ä¼šè¦†ç›–æœ¬åœ°é•œåƒåº“çš„é•œåƒ
```

container çš„ä¿å­˜å’Œå¯¼å…¥
```bash
docker export -o docker_file.tar my-container-name

docker import docker_file.tar my_new_image
# å¯¼å…¥åæˆä¸ºä¸€ä¸ªæ–°çš„ imageï¼Œè¿™ä¸ª image åä¸º my_new_image
```

## é•œåƒ
åˆ—å‡ºå·²ç»å®‰è£…çš„é•œåƒ
```bash
docker image ls # æ˜¾ç¤ºé¡¶å±‚é•œåƒ
docker image ls -a #æ˜¾ç¤ºåŒ…æ‹¬ä¸­é—´å±‚åœ¨å†…çš„æ‰€æœ‰é•œåƒ
```

```bash
# ä»è¿œç«¯ä¸‹è½½é•œåƒ
docker pull <image name>

# åˆ é™¤æŒ‡å®šé•œåƒï¼ˆåˆ é™¤é•œåƒå‰é¡»å…ˆåœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼‰
docker image rm [é•œåƒ]
```

```bash
docker commit [é€‰é¡¹] [å®¹å™¨å] # å°†å®¹å™¨çš„å­˜å‚¨å±‚ä¿å­˜ä¸ºé•œåƒã€‚æ…ç”¨ï¼Œå› ä¸ºå¾ˆå¤šæ–‡ä»¶è¢«æ·»åŠ è¿›æ¥ï¼Œå¯¼è‡´é•œåƒæä¸ºè‡ƒè‚¿
docker history [å®¹å™¨å] # æŸ¥çœ‹é•œåƒçš„å†å²è®°å½•
```

### å®šåˆ¶é•œåƒï¼šDockerfile
åœ¨ç©ºç›®å½•ä¸­å»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå‘½åä¸º`Dockerfile`

```
# åŸºäºubuntué•œåƒä½œä¸ºåŸºç¡€é•œåƒ
FROM ubuntu:latest

# ç»´æŠ¤è€…ä¿¡æ¯ï¼Œå¯ä»¥çœç•¥
MAINTAINER Your Name <your.email@example.com>

# å®‰è£…ä¾èµ–è½¯ä»¶åŒ…
RUN apt-get update && apt-get install -y \
    software-package1 \
    software-package2 \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶æ–‡ä»¶åˆ°é•œåƒä¸­
COPY ./app /app

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®šä¹‰ç¯å¢ƒå˜é‡
ENV ENV_VARIABLE_NAME value

# è¿è¡Œå‘½ä»¤
CMD ["command", "arg1", "arg2"]
```

- æ¯ä¸ªRUNä¼šå»ºç«‹ä¸€å±‚ï¼Œæ‰€ä»¥æ³¨æ„å°½é‡ç”¨ä¸€ä¸ªRUNï¼Œå¹¶ä¸”ç”¨&&æŠŠå¤šä¸ªSHELLå‘½ä»¤ä¸²è”èµ·æ¥


ç„¶åæ‰§è¡Œåˆæ ¼åˆ¶ä½œé•œåƒ
```
docker build -t <é•œåƒåç§°> <Dockerfileè·¯å¾„>
```


å®æˆ˜ï¼š
```bash
FROM ubuntu:latest

MAINTAINER guofei9987 <me@guofei.site>

RUN apt-get update \
    && apt-get install -y sudo \
    && sudo apt update

# C è¯­è¨€
RUN sudo apt install -y gcc make

# Java
RUN sudo apt install -y default-jdk

# Python
RUN sudo apt install -y python3 python3-pip
    
# Rust
RUN sudo apt install -y curl \
    && (curl --proto '=https' --sv1.2 -sSf https://sh.rustup.rs | sh -s -- -y) \
    && source $HOME/.cargo/env
```

è¯´æ˜
- ç½‘ç»œä¸å¤ªå¥½çš„è¯ï¼Œå¾ˆéš¾ä¸€æ¬¡è·‘å‡ºæ¥
- å¯ä»¥ç”¨ `&&` æŠŠæ‰€æœ‰çš„å‘½ä»¤ç²˜èµ·æ¥ï¼Œä»¥èŠ‚çœå­˜å‚¨ç©ºé—´


```bash
# åˆ¶ä½œé•œåƒ
docker build --no-cache -t my_img ./
# --no-cache ç¦ç”¨ç¼“å­˜ï¼Œåœ¨ç½‘ç»œä¸å¥½çš„æ—¶å€™å¯ä»¥é€‰ç”¨

```


æŸ¥çœ‹å®‰è£…æƒ…å†µ
```
gcc --version
make --version

java -version

python3 --version
pip --version

cargo --version

```


### Docker Hub
https://cloud.docker.com

```bash
docker login # ç™»å…¥
docker logout # ç™»å‡º

docker search <name> #æœç´¢
# ä¾‹å¦‚ docker search mysql å¯ä»¥æœç´¢æ‰€æœ‰mysqlå…³é”®è¯
# å•ä¸ªå•è¯å¾—é•œåƒæ˜¯å®˜æ–¹é•œåƒï¼Œguofei9987/mysql æ˜¯ç”¨æˆ·åšçš„é•œåƒ
```

æ¨é€é•œåƒ
```bash
docker tag ubuntu guofei9987/ubuntu
docker push guofei9987/ubuntu
```

## å¸¸ç”¨
æ¸…é™¤å…¨éƒ¨container
```
docker container rm -f $(docker container ls -aq)
```

åŸºç¡€ linux
```bash
docker run -it --volume ${HOME}:${HOME} ubuntu bash

# å®‰è£…å¸¸ç”¨å·¥å…·
apt-get update
apt-get install sudo
apt install tree

# è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
export LANG="zh_CN.UTF-8"
. /etc/profile
```


Anaconda
```bash
docker run -it --volume ${HOME}:${HOME} continuumio/anaconda3 bash

# æŠŠæœ¬æœºçš„è®¾ç½®é»è´´åˆ°dockerä¸­
cp /Users/guofei/.gitconfig ~/.gitconfig
cp -a /Users/guofei/.ssh ~/.ssh
```

jekyll
```sh
docker run --rm --label=jekyll --volume /Users/guofei/github/guofei9987.github.io:/srv/jekyll/blog_md_dir -it -p 127.0.0.1:4006:4000 jekyll/jekyll jekyll serve --force_polling --destination /srv/jekyll/blog --source /srv/jekyll/blog_md_dir
```

mysql
```sh
docker run --name=mysql1 -d mysql/mysql-server

# è·å¾—åˆå§‹å¯†ç ï¼š
docker logs mysql1
docker logs mysql1 2>&1 | grep GENERATED

docker exec -it mysql1 mysql -uroot -p

# ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œéœ€è¦æ”¹å¯†ç 
mysql>ALTER USER 'root'@'localhost' IDENTIFIED BY 'password';
```


ä¸€äº›è¯­è¨€
```sh
# rust
docker run -it --volume ${HOME}:${HOME} rust bash 
docker run -it --volume ${HOME}:${HOME} --platform=linux/amd64 rust bash 

# java
docker run -it --volume ${HOME}:${HOME} --platform=linux/amd64 maven bash 
# amd64 åˆç§°ä¸º x86-64 æˆ– x64ï¼Œæ˜¯æœ€å¸¸è§çš„
# ç›¸æ¯”ä¹‹ä¸‹ï¼ŒMacBook çš„ M ç³»åˆ—èŠ¯ç‰‡æ˜¯ arm æ¶æ„
```



## å‚è€ƒèµ„æ–™
https://blog.csdn.net/liukuan73/article/details/78089138/
