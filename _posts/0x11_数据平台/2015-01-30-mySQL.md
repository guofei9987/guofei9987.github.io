---
layout: post
title: å„ç§æ•°æ®åº“æ–¹è¨€
categories:
tags: 0x11_ç®—æ³•å¹³å°
keywords:
description:
order: 173
---


SQL ç³»åˆ—æ–‡ç« 
- [ğŸ”¥ã€SQLã€‘SELECTä¸“é¢˜](https://www.guofei.site/2018/03/20/sqlselect.html)ï¼Œä¸»è¦å†…å®¹æ˜¯ SELECT è¯­å¥
- [ã€SQLã€‘é€šç”¨è¯­æ³•](https://www.guofei.site/2015/02/03/SQL.html)ï¼Œä¸»è¦å†…å®¹æ˜¯ CREATEã€ALTERã€INSERT ç­‰é€šç”¨çš„ SQL è¯­æ³•
- [å„ç§æ•°æ®åº“æ–¹è¨€](https://www.guofei.site/2015/01/30/mySQL.html)ï¼Œå„ç§æ•°æ®åº“çš„ç›¸å…³å‘½ä»¤ï¼Œå¦‚ HIVEã€MySQLã€SQL Server
- [ã€pythonã€‘sqlAlchemy](https://www.guofei.site/2018/03/21/sqlalchemy.html)


## MySQL

### ç™»å½•åˆ°MySQL
```
mysql -h ä¸»æœºå -u ç”¨æˆ·å -p
```
- -h : æŒ‡å®šå®¢æˆ·ç«¯æ‰€è¦ç™»å½•çš„MySQLä¸»æœºå, ç™»å½•å½“å‰æœºå™¨è¯¥å‚æ•°å¯ä»¥çœç•¥;
- -u : ç”¨æˆ·å;
- -p : å¯†ç , å¦‚æœå¯†ç ä¸ºç©º, å¯ä»¥å¿½ç•¥æ­¤é€‰é¡¹ã€‚

**ä¿®æ”¹ root ç”¨æˆ·å¯†ç **
```
mysqladmin -u root -p password æ–°å¯†ç 
```

### è§†å›¾

```sql
-- 1ã€åˆ›å»ºè§†å›¾

CREATE VIEW view_name AS
SELECT id,name
FROM table_name;

-- 2ã€æŸ¥è¯¢è§†å›¾
SELECT * FROM view_name;

-- 3ã€åˆ é™¤è§†å›¾
DROP VIEW view_name;

-- 4ã€ä¿®æ”¹è§†å›¾
ALTER VIEW view_name as select è¯­å¥;

-- 5ã€æ’å…¥æ•°æ®
INSERT INTO view_name (å±æ€§1,å±æ€§2) values (ã€‚ã€‚ã€‚)

-- 6ã€æ›´æ”¹æ•°æ®
UPDATE view_name
SET å±æ€§1=å€¼1
WHERE ...
```

å¯¹ VIEW çš„æ’å…¥/æ›´æ”¹ï¼š
1. æ›´æ”¹çš„æ˜¯ table ä¸­çš„æ•°æ®
2. åªæœ‰ç®€å• VIEW æ‰å…è®¸æ’å…¥/æ›´æ”¹ã€‚ç®€å• VIEWï¼šå•è¡¨ã€æ²¡æœ‰ GROUP BYã€DISTINCTã€å­æŸ¥è¯¢ç­‰ï¼Œè€Œä¸”å¿…é¡»åŒ…å«ä¸»é”®ã€‚å¦åˆ™æ•°æ®åº“ä¸çŸ¥é“å¦‚ä½•æ›´æ”¹å¯¹åº”çš„ Table


### ç´¢å¼•

**1ã€åˆ›å»ºè¡¨æ—¶åˆ›å»ºç´¢å¼•**
```
create table table_name(
å±æ€§å æ•°æ®ç±»å‹
å±æ€§å æ•°æ®ç±»å‹
...
å±æ€§å æ•°æ®ç±»å‹
index [ç´¢å¼•å](å±æ€§å1)
)ï¼›
```

ä¾‹å­ï¼š
```
create table t_dept(
deptno int,
dname varchar(20),
loc varchar(40),
index index_deptno(deptno)
);
```

æ£€éªŒç´¢å¼•æ˜¯å¦åˆ›å»ºæˆåŠŸ
```
show create table t_dept \G
```
æ£€éªŒç´¢å¼•æ˜¯å¦è¢«å¯ç”¨
```
explain
select * from t_dept where deptno=1;
```

**2ã€å·²ç»å­˜åœ¨çš„è¡¨ä¸­æ·»åŠ ç´¢å¼•**
```
create index ç´¢å¼•å
    on è¡¨å(å±æ€§åã€(é•¿åº¦)ã€‘)ã€(ASC|DESC)ã€‘;
```

**3ã€ç”¨alter**
```
alter talbe table_name
    ADD index ç´¢å¼•å(å±æ€§åã€(é•¿åº¦)ã€‘ã€(ASC|DESCã€‘);
```


4ã€ä»¥ä¸Š `index` å¯ä»¥æ›´æ”¹ä¸º `key`ï¼Œæ•ˆæœç›¸åŒ
ä»¥ä¸Šindexå¯ä»¥æ›´æ”¹ä¸ºunique indexï¼Œæˆ–è€…unique keyï¼Œå˜æˆä¸å…è®¸é‡å¤çš„ç´¢å¼•

5ã€ä»¥ä¸Š `index` å¯ä»¥æ›´æ”¹ä¸º `full text index|key`

**6ã€å¤šåˆ—ç´¢å¼•**

æœ«å°¾æ¢æˆï¼š
```
ç´¢å¼•å(å±æ€§å1ã€(é•¿åº¦)ã€‘ã€(ASC|DESCã€‘,å±æ€§å2,å±æ€§å3);
```

**7ã€åˆ é™¤ç´¢å¼•**
```
drop index index_name on table_name;
```

## SQL Server

ç³»ç»Ÿæ•°æ®åº“åˆ†ä¸ºè¿™å‡ ä¸ªï¼š
- Masterï¼šå­˜å‚¨å…ƒæ•°æ®ï¼Œä¾‹å¦‚åˆ«çš„æ•°æ®åº“çš„ table ä¿¡æ¯
- Modelï¼šæ¨¡ç‰ˆæ•°æ®åº“ï¼Œæ–°çš„æ•°æ®åº“ä»¥æ­¤ä¸ºæ¨¡ç‰ˆåˆ›å»º
- Msdbï¼šä»£ç†æœåŠ¡æ•°æ®åº“ï¼Œæä¾›ä¸€ä¸ªå­˜å‚¨ç©ºé—´
- Tempdbï¼šä¸´æ—¶æ•°æ®åº“ï¼Œæ‰€æœ‰çš„ä¸´æ—¶è¡¨ã€å­˜å‚¨è¿‡ç¨‹ã€ä¸´æ—¶æ“ä½œæä¾›çš„å­˜å‚¨ç©ºé—´ã€‚æ–­å¼€è¿æ¥æ—¶è‡ªåŠ¨åˆ é™¤ã€‚







## Hive-SQL


### å»ºè¡¨

1. å»ºä¸€ä¸ªæ™®é€šè¡¨
```sql
DROP TABLE IF EXISTS app.app_example;
CREATE TABLE app.app_example(
id int comment 'idå¯¹åº”çš„è§£é‡Š',
col1 int comment 'è§£é‡Š1',
col2 int comment 'è§£é‡Š2'
)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';
```
2. å»ºä¸€ä¸ªåˆ†åŒºè¡¨
```sql
DROP TABLE IF EXISTS app.app_example;
CREATE TABLE app.app_example(
id int comment 'idå¯¹åº”çš„è§£é‡Š',
col1 int comment 'è§£é‡Š1',
col2 int comment 'è§£é‡Š2'
)
partitioned by (dt string)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
location '/user/guofei/app_example'
stored as orc
TBLPROPERTIES ('author'='guofei');
```

### æ’å…¥æ•°æ®

1. ä»æœ¬åœ°æ•°æ®æ’å…¥
```sql
load data local inpath 'file_path' into table tbname;
load data local inpath 'file_path' overwrite into table tbname; -- overwriteæŠ¹é™¤åŸæ•°æ®
LOAD DATA LOCAL INPATH  'file_path' INTO TABLE tbname PARTITION (country='US', state='CA') -- æ’å…¥åˆ†åŒºè¡¨ï¼Œå¢é‡æ·»åŠ ï¼Œä¸æ˜¯è¦†ç›–
LOAD DATA LOCAL INPATH  'file_path' OVERWIRTE INTO TABLE tbname PARTITION (country='US', state='CA') -- æ’å…¥åˆ†åŒºè¡¨ï¼Œå¸¦overwirteè¡¨ç¤ºè¦†ç›–
```
2. ä»æŸ¥è¯¢æ’å…¥æ•°æ®
```sql
-- æ–°å»ºä¸€ä¸ªè¡¨ï¼Œå¹¶ä»¥overwriteçš„æ–¹å¼å†™å…¥æ•°æ®
CREATE TABLE tb2 AS SELECT * from tablename1; 
-- è¦†ç›–å¼æ’å…¥æ•°æ®
insert overwrite table tb2 select * from tb1; 
-- æ–°å¢å¼æ’å…¥æ•°æ®
INSERT INTO TABLE tablename2 SELECT * FROM tablename1ï¼›
-- é™æ€æ–¹å¼æ’å…¥åˆ†åŒºè¡¨ï¼š
insert overwrite table tmp.tmp_test
partition (country='US',state='OR')
select names from tbname1;
-- åŠ¨æ€æ–¹å¼æ’å…¥åˆ°åˆ†åŒºè¡¨ï¼š
set hive.exec.dynamic.partition.mode=nonstrict;
INSERT OVERWRITE TABLE app.app_example PARTITION(dt)
SELECT col1,col2,sysdate(-1) as dt
FROM
app.example_1
-- åŠ¨æ€æ–¹å¼å¿…é¡»æŠŠåˆ†åŒºkeyæ”¾åœ¨æœ€åï¼Œä¼˜ç‚¹æ˜¯å¯ä»¥åŒæ—¶å‘å¤šä¸ªåˆ†åŒºæ’å…¥æ•°æ®
-- overwriteè¡¨ç¤ºè¦†ç›–æ’å…¥ï¼Œå»æ‰overwriteè¡¨ç¤ºå¢é‡æ·»åŠ 
```

ä¾‹å­ï¼š
```sql
DROP TABLE IF EXISTS app.app_example;
CREATE TABLE app.app_example AS
SELECT * FROM app.example_1;
```

### åˆ é™¤æ•°æ®

```sql
ALTER TABLE tablename DROP IF EXISTS PARTITION(year = 2015, month = 10, day = 1);


-- æ¸…é™¤æ•°æ®
TRUNCATE TABLE tablename;
```

### ä¿®æ”¹åˆ—
Hiveä¿®æ”¹è¡¨åï¼Œåˆ—åï¼Œåˆ—æ³¨é‡Šï¼Œè¡¨æ³¨é‡Šï¼Œå¢åŠ åˆ—ï¼Œè°ƒæ•´åˆ—é¡ºåºï¼Œå±æ€§åç­‰æ“ä½œ
```sql
-- é‡å‘½åè¡¨å
ALTER TABLE table_name RENAME TO new_name


ALTER TABLE table_name ADD COLUMNS (col_spec[, col_spec ...])
ALTER TABLE table_name DROP [COLUMN] column_name
ALTER TABLE table_name CHANGE column_name new_name new_type
ALTER TABLE table_name REPLACE COLUMNS (col_spec[, col_spec ...])
```



**æ”¹å˜åˆ—å/ç±»å‹/ä½ç½®/æ³¨é‡Š**
```sql
ALTER TABLE table_name
CHANGE COLUMN
col_old_name col_new_name column_type
[COMMENT col_conmment]
[FIRST|AFTER column_name];
```
ç”¨æ¥ä¿®æ”¹è¡¨çš„åˆ—åã€æ•°æ®ç±»å‹ï¼Œåˆ—æ³¨é‡Šå’Œåˆ—æ‰€åœ¨çš„ä½ç½®
FIRSTå°†åˆ—æ”¾åœ¨ç¬¬ä¸€åˆ—ï¼ŒAFTER col_nameå°†åˆ—æ”¾åœ¨col_nameåé¢ä¸€åˆ—ï¼Œ



ADD COLUMNSå…è®¸ç”¨æˆ·åœ¨å½“å‰åˆ—çš„æœ«å°¾ï¼Œåˆ†åŒºåˆ—ä¹‹å‰æ·»åŠ æ–°çš„åˆ—
```
ALTER TABLE table_name ADD
COLUMNS (col_name data_type [CONMMENT col_comment], ...);
```


### å…¶å®ƒæ“ä½œ

```
show databases
use database_name
```


1. hiveæ¨¡ç³Šæœç´¢è¡¨
```sql
show tables
show tables like '*name*';
show table extended like 'test_partition';
-- åŠ ä¸Š extended åï¼Œä¼šé¢å¤–æ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼š
-- locationï¼Œformatï¼Œcolumnsï¼Œpartitionï¼Œæ–‡ä»¶æ•°ï¼Œæ–‡ä»¶å¤§å°ï¼Œæœ€åä¸€æ¬¡ç¼–è¾‘æ—¶é—´å’Œè®¿é—®æ—¶é—´
SHOW TBLPROPERTIES [table_name] -- æ˜¾ç¤ºæŒ‡å®šè¡¨åçš„TBLPROPERTIESä¿¡æ¯ï¼ˆå¥½åƒshow create table [table_name]æ›´å…¨ï¼‰
```
2. æŸ¥çœ‹è¡¨ç»“æ„ä¿¡æ¯
```sql
desc formatted table_name;
desc table_name;
```
3. æŸ¥çœ‹åˆ†åŒºä¿¡æ¯
```sql
show partitions table_name;
```





## å‚è€ƒèµ„æ–™
ã€ŠmySQLä»å…¥é—¨åˆ°ç²¾é€šã€‹  
https://wenku.baidu.com/view/f7f6e6dcd1f34693daef3e8b.html  
http://www.w3school.com.cn/sql/  
https://blog.csdn.net/helloxiaozhe/article/details/80749094  
http://blog.csdn.net/mulangren1988/article/details/77509195  
