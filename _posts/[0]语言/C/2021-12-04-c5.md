---
layout: post
title: 【C5】读写文件
categories: 语言
tags:
keywords:
description:
order: 12001
---

## open和close

```c
// FILE	*fopen(const char *filename, const char *mode)

FILE *p = fopen("./a.txt", "r");
// 如果打开失败，p = NULL;

// 如果打开成功，需要关闭。（如果打开失败，关不关都行）
int fclose(*p);
```

mode
- `r` 读，必须存在
- `r+` 读写，必须存在
- `rb+` 二进制读写，必须存在
- `rw+` 读写
- `w` 写，不存在则建立，存在则清空
- `w+`
- `a` 附加写入
- `a+`

## getc和putc读写char


```c
// 不需要放到代码里面
#define EOF -1; // 文件结尾的标识，它不是文件的一部分内容
```

读内容
```c
int main() {
    FILE *p = fopen("./a.txt", "r");
    if (p) {
        printf("open success\n");

        char c=getc(p);
        while (c!=EOF){
            printf("%c",c);
            c=getc(p);
        }

    } else {
        printf("open fail\n");
    }

    printf("\n");
    fclose(p);
}
```


实现一个读内容的函数

```c
int my_read(int argc, char **args) {
    if (argc < 2)
        return 0;

    FILE *p = fopen(args[1], "r");
    if (p != NULL) {
        char c = getc(p);
        while (c != EOF) {
            printf("%c", c);
            c = getc(p);
        }
        printf("\n");

    } else {
        printf("fail!\n");
    }
    fclose(p);
    return 0;
}

int main(int argc, char **args) {
    return my_read(argc, args);
}
```

实现一个写内容的函数
```c
int my_write(unsigned long len_text, char *text, char *filename) {
    FILE *p = fopen(filename, "w");

    if (p) {
        for (int i = 0; i < len_text; i++) {
            printf("%c\n", text[i]);
            putc(text[i], p);
        }
        fclose(p);
    } else {
        printf("read fail!\n");
    }

    return 0;
}

int main() {
    char *text = "abc";
    char *filename = "./a.txt";
    my_write(strlen(text), text, filename);
    return 0;
}
```

### 练习

做一个文件拷贝代码

```c
int main() {

    FILE *p1 = fopen("./a.txt", "r");
    FILE *p2 = fopen("./b.txt", "w");

    if ((p1 != NULL) && (p2 != NULL)) {
        char c = getc(p1);
        while (c != EOF) {
            putc(c, p2);
            c = getc(p1);
        }
    }
}
```

练习：做一个加密代码:  
思路：保存前`c=c+1;` 加密 `c=c-1;` 解密

## fprint和fputs（最有用）

前面写过，打印字符串和获取用户输入可以这么做
```c
fgets(a, sizeof(a), stdin);
fputs(a, stdout);
```

他们还能用来读写文本文件:

写入文件
```c
// 写入文件
FILE *p = fopen("./a.txt", "w");

if (p) {
    fputs("hello world，你好！", p);
    fclose(p);
} else { printf("read fail\n"); }
```

读取文件（读一行）
```c
FILE *p = fopen("./a.txt", "r");
char buf[1024] = {};
fgets(buf, sizeof(buf), p); // 这里一次读取一行
printf("%s", buf);
```

读取文件（读多行）

```c
// feof(p) 当前遇到结尾返回 1，否则返回 0
int main() {

    FILE *p = fopen("./a.txt", "r");
    char buf[1024] = {};
    if (p == NULL) {
        printf("read fail!\n");
        return 0;
    }
    while (!feof(p)) { // 判断是否已到文件结尾
        fgets(buf, sizeof(buf), p); //读一行，buf的末尾会包含\n
        printf("%s", buf);

    }

    return 0;
}
```

## fcanf和fprintf
我们知道，
- scanf 是从字符串中读取，并按照指定格式提取某些值。  
- printf 是按照指定格式打印某些值

类似的
- fscanf 是从文件中读取，并按照指定格式提取某些值。
- fprintf 是按照指定格式把某些值写到文件中

例子：
```c
// a.txt的样子：  12+35=
FILE *p1 = fopen("./a.txt", "r");
FILE *p2 = fopen("./b.txt", "w");


int a;
char b;
int c;
fscanf(p1, "%d%c%d=", &a, &b, &c);
fprintf(p2, "%d%c%d=%d", a, b, c, a + c);


printf("%d%c%d=", a, b, c);

```

注意 **fcanf** 不支持feof(p)？？未验证


## 练习题

题目1
1. 生成一个文件，里面有100万个0到255的随机数，
2. 研发一个排序算法，对这个文件排序，然后写回去
    - 只准用栈，不准用堆
    - 目标文件是超大文件


题目2：实现一个简单的文件加密代码

题目3:又一个文件，里面有多行加减乘除算式。写一个程序，把算式和结果写到另一个文件中。每行算式长度不超过100


题目4:print和scan相关的函数很多，整理成一个表，方便使用
- 解决这个问题：一个文件是格式化的 “姓名=张三，年龄=20” 这种，提取其中的姓名和年龄
- 打印年龄第2大的人的姓名



end
