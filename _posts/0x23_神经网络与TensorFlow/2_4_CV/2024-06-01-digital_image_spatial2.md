---
layout: post
title: 【数字图像处理2】编码、压缩
categories:
tags: 0x25_CV
keywords:
description:
order: 1014
---



### 图片格式


准备知识
1. 压缩方法：有损vs无损
2. 索引色vs直接色
    - 索引色是存储一个索引，然后点阵用索引来表示。
    - 直接色。用数字来表示颜色，例如 RGBA
3. 点阵图vs矢量图


|格式|特点|简评|
|--|--|--|
|BMP(BitMap)|无损，支持索引色和直接色，点阵图|古老格式。无压缩，通常很大|
|GIF(Graphics Interchange Format)|无损、索引色、点阵图|用 LZW 压缩算法。仅支持8bit的索引色，也就是说整个图片只能有 256 种颜色。适用于对色彩要求不高同时需要文件体积较小的场景，比如企业Logo、线框类的图等。还支持动图。
|JPEG|有损、直接色、点阵图|设计目标是在不影响人类可分辨的图片质量的前提下，尽可能的压缩文件大小。用直接色所以色彩丰富，适合存储照片。与GIF相比，不适合用来存储企业Logo、线框类的图。因为有损压缩会导致图片模糊，而直接色又会导致图片文件较GIF更大。|
|PNG-8(Portable Network Graphics)|无损、索引色、点阵图|最多 256 种颜色，尽可能使用PNG-8而不是GIF，它体积更小，还支持透明度的调节。PNG 都使用了 DEFLATE 压缩算法|
|PNG-24|无损，直接色，点阵图|是PNG的直接色版本。RGB 的 3 通道各用8bit来存储|
|PNG-32|无损、直接色、点阵图|RGBA 的 4 通道各用8bit来存储|
|SVG(Scalable Vector Graphics)|无损、矢量图|使用XML来描述图片|
|WebP|支持有损和无损压缩的、直接色、点阵图|谷歌开发，目标是相同精度下尽量降低体积
|tiff||一般用于印刷图片，平面设计可以保存格式并发送给制作部门制作实物，图片也一般较大
RAW||存储相机传感器捕获的未经处理的数据，体积很大。可以无限次调整曝光、色温、白平衡而不降低图像质量。无需担心像 JPEG 那样每次编辑都降低质量

## 视频格式

|格式|特点|其它
|--|--|--|
| `.avi`|图像质量好，体积庞大|微软开发。压缩标准不统一，时常会出现由于视频编码问题
|MPEG（`.MPG .MPEG .MPE .DAT .VOB .ASF .3GP .MP4`|使用最少的数据获得最佳的图像质量|英文全称为Moving Picture Experts Group
|Real Video `.RM .RMVB`|400-500kbps码率下还有很不错的清晰度
|flv|比RMVB更优秀
|`.MOV`|美国Apple公司开发的一种视频格式，默认的播放器是苹果的QuickTime|QuickTime File Format
|WMV `.WMV .ASF`|本地或网络回放,丰富的流间关系以及扩展性等。需要在网站上播放，需要安装Windows Media Player，很不方便，现在已经几乎没有网站采用了。|微软，Windows Media Video
|Matroska `.MKV`|是一种新的多媒体封装格式，这个封装格式可把多种不同编码的视频及16条或以上不同格式的音频和语言不同的字幕封装到一个Matroska Media档内。它也是其中一种开放源代码的多媒体封装格式。Matroska同时还可以提供非常好的交互功能，而且比MPEG的方便、强大。



总结:
- MKV是比较先进的。
- H.264.现在常用。H.265 压缩率更好

指标
- 码率(Mbps)*时间(秒)/8=文件大小(MB)
- 1080p的：视频码率过一万，分辨率1920x1080，文件大小10g+
- 720的：视频码率大概是3000～4000，分率1280x720，文件大小5g左右
在线点播网站顶多只能算伪高清，只有分辨率达到标准，码率只有2000左右。对高清发烧友而言，这是无法忍受的。


## JPEG 压缩算法



有这几个步骤：
1. 颜色空间转换。RGB 转 YCbCr
    - Y分量表示亮度（明亮程度），而Cb和Cr分量则表示色度（颜色信息）。
    - 原理：人眼对亮度变化更敏感，因此可以对亮度和颜色做不同程度的压缩。
2. 下采样（Subsampling）
    - 最常见的4:2:0，在每个 2x2 区域上，保留 4 个 Y 值，1 个平均后的 Cb 值，1 个平均后的 Cr 值
    - 4:2:2，水平的 2x1 区域上，保留 2 个 Y 值，1 个平均后的 Cb 值，1 个平均后的 Cr 值
    - 4:4:4，不做下采样，所有值都保留
3. 分块。将图像划分为 8×8 的像素块。
4. 离散余弦变换（DCT）：对每个 8x8 块进行DCT变换。
    - 原理：人眼对高频信息敏感度小于低频信息
    - DCT将空间域（像素值）转换为频率域，大多数高频信息会被压缩，而低频信息则会被重点保留。
    - 8x8 的区域 DCT 后，生成一个 8x8 的实数矩阵
5. 量化（Quantization）
    - 关键的有损步骤，极大提高压缩程度。
    - 使用量化表对 DCT 系数进行量化。量化表是一个预先定义的矩阵，其中每个元素对应于 DCT 系数的一个缩放因子。
    - 将 DCT 系数除以量化表中的相应元素，然后四舍五入为整数，减少系数的精度，从而实现压缩。量化表的设计通常根据人类视觉系统的特性进行，对低频系数采用较小的量化步长，对高频系数采用较大的量化步长。
    - 合理选择量化表，可以在压缩比和图像质量之间进行平衡。
    - 看起来量化过程把一个 8x8 矩阵映射到另一个 8x8 矩阵，那么这过程中如何压缩数据的？
        - 高频区域对应的系数更可能压缩到接近0，从而变成 0，这样系数矩阵变得更加稀疏，在下一步能很好的压缩；而其它区域产生的结果，也是几十以内的整数，可以用较少的位表示；
5. 熵编码（Entropy Coding）：对量化后的DCT系数进行熵编码，通常使用哈夫曼编码来进一步压缩数据。熵编码可以根据符号出现的频率对数据进行编码，从而实现有效压缩。
    - 图像较大时，确定 Huffman 树消耗计算资源较多，因此往往预先规定一个 Huffman 编码表
6. 生成JPEG文件：上述处理后的数据，添加元信息、压缩信息，输出为图片文件


而解压过程则是以上步骤倒过来




名词解释
- 高频区域：细节、噪声
- 低频区域：图像的大面积的均匀区域、缓慢变化的色调以及物体的大致轮廓等。例如：一幅蓝天白云的照片中，广阔的蓝天部分颜色变化相对缓慢，这就是低频信息的体现。天空的整体色调较为一致，没有剧烈的色彩或亮度变化。一个人物肖像照片中，人物的脸部大面积的肤色区域通常也属于低频信息，因为肤色在局部范围内的变化相对较小。



![jpeg算法](/pictures_for_blog/digital_image_processing/jpeg.png)

## 其他压缩理论

考虑使用 720✖️480✖️24 比特像素阵列描绘 1小时的电影，其大小是：（30帧/秒）✖️（720✖️480 像素/帧）✖️（3字节/像素）✖️（3600秒/小时）✖️（2小时）≈200GB  

这肯定是不能接受的。


对冗余做分类
- 编码冗余。例如，颜色出现的次数不一样，但都用8位bit
    - 解决方案：变长编码（一个例子是 Huffman 编码）
- 空间和时间冗余。例如，灰度图很多像素和相邻像素是一样的，因此没必要重复。视频里相邻帧的像素也很可能是一样的。
- 不相关信息。例如，包含一些人类视觉系统无法感知的，或者用途无关的信息。

一些常用方法
- Huffman 编码
- Golomb 编码。用于对非负整数的编码。如果被表示的整数服从集合分布，压缩效果最好。
- LZW 编码
    - 利用了空间结构，因此往往比 Huffman 压缩率更高。
    - LZW 编码先生成一个字典，然后把某些连续的像素映射到字典上。  
    - 例如，采用9比特字典（也就是字典容量512个），然后把“连续两个白色像素”映射到某个表示（例如256）。如果图像中有很多“连续两个白色像素”，那么就达到了很好的压缩效果。  
    - 另外，0～255这256个，仍然分配给原本的0～255灰度级。


行程编码。编码模式中，用两个字节 RLE 表示，
- 第一个字节表示连续像素的数目。0表示一行的末尾或整个图像的末尾。
- 第二个字节表示颜色索引。如果是8比特，表示256色。

行程编码绝对值模式
- 第一个字节是0
- 第二个字节通知4种可能的条件
    - 第二个字节是0，表示一行的末尾
    - 第二个字节是1，表示一幅图的末尾
    - 第二个字节是2，则下两个字节是水平偏移和垂直偏移
    - 第二个字节是3～255之间，指定非压缩像素的数量


## 打印和印刷

历史上有很多种，不多提

打印：
1. 喷墨。加热或者机械压力方式，把墨水从打印头喷出，形成图文
    - 包括连续喷墨、按需喷墨
    - 油墨干燥的问题。纸张对油墨的承载力
2. 激光。用激光在感光鼓上形成图文，然后感光鼓转动，通过静电吸附带电碳粉，再将碳粉加热转印到纸张上。
    - 与喷墨相比
        - 机器比喷墨贵，但运行成本低，墨粉便宜。
        - 打印速度快
        - 打印质量高，文本清晰，适合办公文档打印。喷墨能够处理更多的颜色和渐变，适合打印照片。
        - 喷墨打印机使用不频繁墨水会干，需要定期维护



半色调加网技术
- 问题：印刷机的油墨无法直接做出连续色调渐变。例如，某颜色只能做出若干个色阶，如何打印出上百种色阶呢？
- 解决：使用墨点的疏密来表表示颜色层次的变化，这样打印出来的图像在人眼视网膜上就是渐变的。这叫做加网
- 本质上是用 PPI 换颜色丰富度
- 方案：网点可以是正方形、菱形、圆形、椭圆形。
    - 菱形：实践证明最好
    - 圆形、椭圆形：密集区域容易油墨堆叠。但是亮区圆形比较好，中间区椭圆形比较好
- 参数计算：某种色阶对应的网点密度、网点的角度的转换公式。（略，用的时候可以查资料或者自己算）。这个转换公式还牵涉到油墨本身的反射率、透光率等


菱形网点的例子：

![halftoning](/pictures_for_blog/digital_image_processing/halftoning1.gif)


关于彩图

![halftoning](/pictures_for_blog/digital_image_processing/halftoning2.png)

上面的示意图展示了：仅使用3种颜色的小墨点（不是叠加，而是仅仅相邻排布），即可组合成各种各样的颜色
- 仅仅是示意图，因为这个排布很粗暴，很容易出现摩尔纹。况且是基于显示器的“加法模型”，实际印刷物用的是“减法模型”



### 半色调信息隐藏



基于网点形状的信息隐藏（一些资料上叫做“基于调幅的加网信息隐藏”）
- 任务：想把一个黑白图片（代表密文）隐藏在一个印刷品（载体）里
- 思路：加网时一般用菱形，那么可以把一些位置换成别的形状，以此嵌入信息
- 为了加密，以及防止人眼能察觉出载体有规律变化，先在空间上打乱黑白图片的排布
- 嵌入过程：遍历密文，如果是黑点，就把载体对应位置从菱形换成圆形（或别的网点样式）


基于调频
- 改变的是加网的方式。例如，遍历密文，遇到黑点，那么印刷品上的加网方式是“中间黑、四周白”；遇到白点，那么加网方式为“中间白、四周黑”


抗复制
- 调整加网方式，使印刷品在扫描时容易产生摩尔纹，同时人眼却无法看出异常




基于 CMYK 的同色异谱特性，进行信息隐藏
- 人眼只对3个频率（以及其附近的区域）有感知，而 CMYK 则用来配置使这些频谱，使其防线进入人眼时的频谱在3个频率（以及其附近的区域）符合预期
- 也就是说，别的区域实际上嵌入很多信息。
- 例如，构造一组配色 C1M1Y1K1，另一组配色 C2M2Y2K2，两个配合使用，来表示嵌入了 0、1 信息
- 通俗来讲，人眼只能感受3种颜色，那么可以配置3种颜色之外的别的颜色，来印刷隐藏的信息就行了。
- 更简化的做法：使用某些特殊涂料，这些涂料在紫外线下显示白色、或者在红外线下反射特殊的光谱。






### 摩尔纹

摩尔纹（Moiré pattern）是当两个规则图案（通常是线条或网格）重叠时，由于它们的角度、线条间距或线条宽度不一致而形成的视觉干扰图案。
- 摩尔纹本身通常在印刷和屏幕显示中被视为一种不良现象，因为它会干扰图像的清晰度和质量。
- 然而，它可以用作一种防伪技术。


如何用摩尔纹作为防伪手段
1. 复杂的图案组合。在印刷材料上设计专门的图案或线条，当这些图案与另一层特定的图案重叠时，会产生独特的摩尔纹。这种摩尔纹难以复制，因为它需要精确的图案对齐和特定的印刷技术。
2. 摩尔纹可以与其他防伪技术如全息图、变色油墨等结合使用，提高安全性和防伪能力。
3. 数字验证：摩尔纹也可以设计成只有通过特定的数字扫描设备或应用程序才能正确解析的形式，增加复制的难度。

## 印刷品防伪

印刷工艺防伪
- 凸印、平印、凹印、丝相结合。凸版印刷机优势在于印刷压力大，擅长大面积的实色区域；平版印刷机又是在于压力平柔，擅长图画层次变化、复杂线条。如果把这些印刷机结合起来，其工序越复杂，越难以伪造。
- 多色串印。在墨槽种按一定距离放置隔板，不同的隔段里放入不同色相的油墨。在串墨棍的串动下，印刷上去。仿冒者很难通过印刷品来反推出隔板间距，从而增加假冒难度
- 雕刻凹版。原本是一种版画艺术，画家在铜板上雕刻均匀、细致的线条，由此印刷出的印刷品，即使细如毫发，也清晰可辨，色泽经久不变。当今各国钞票、邮票等普遍使用此技术来防伪。每个雕刻师有自己的刀法、风格，旁人很难模仿，即使雕刻师本人也很难做出两个完全相同的雕刻板
- 特种光泽。
    1. 金属光泽：用铝箔类金属复合纸
    2. 珠光印刷：在印刷品表面先铺上银浆，然后用极透明的油墨印刷，银光透过油墨折射出珠光效果
    3. 珍珠光泽印刷：油墨中添加云母颗粒，产生贝壳、珍珠的效果
    4. 折光印刷：用一定的压力把图纹压印在印刷品上，产生独特的光折射效果
    5. 哑光印刷：用哑光油墨，或者普通油墨印刷后覆盖消光膜，产生朦胧的弱光泽


特殊的油墨防伪
1. 磁性防伪油墨。用机器来检测
2. 光学可变防伪油墨。改变观察角度时，颜色会变
3. 紫外荧光油墨
4. 热敏油墨、红外防伪油墨
5. 化学变色类油墨。
    1. 防涂改油墨：被消字灵土改后变色使其容易被察觉
    2. 压敏变色油墨。按压、摩擦后发生色变，可以是化学反应，也可以是微胶囊染料破裂
    3. 化学加密油墨。涂抹某种化学试剂后显色
6. 摩擦变色类防伪油墨
7. 透印式油墨。燃料渗透到纸张纤维，透到纸背，使其无法用刮刀篡改
8. 湿敏变色油墨
9. 智读机防伪。智都机可以读取材料的化学特征，来做防伪

承印材料防伪
1. 印钞纸。这类纸坚韧、光洁、耐磨、不易断裂，通常添加了本国特有的物质，例如日本钞票用了三桠皮
2. 水印纸。古老的防伪技术。造纸时用丝网安装水印，或者滚筒压制水印
3. 安全防伪纸。造纸时加入金线、塑料线
4. 防复印纸。两类：1）光吸收型，使某些纹路的某通道（例如绿色），在复印机光下无法显示，那就复印出来的颜色不对。2）光漫反射，纸上附着一层铝薄膜，扫描时一片模糊，或者出现“无效”等字样
5. 热敏纸

光谱防伪
- 使用一些相位掩膜器件，它仅能改变光纤的相位。把信息隐藏在相位中，利用机器来读取相位
- 光学全息防伪技术。利用光的干涉和衍射原理。


二维码技术
- 以上的有关信息隐藏方面的技术，都可以与二维码技术结合。可以提高纠错、加密能力

## 参考资料

曹鹏：《半色调信息隐藏与防伪技术》